{"ast":null,"code":"import React,{useState,useEffect}from'react';import{createPortal}from'react-dom';import{Input,Button,message,Divider}from'antd';import{UserOutlined}from'@ant-design/icons';import{authService}from'../../services/authService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LoginModal=_ref=>{let{visible,onClose,onSuccess}=_ref;const[loading,setLoading]=useState(false);const[activeTab,setActiveTab]=useState('login');const[loginData,setLoginData]=useState({username:'',password:''});const[registerData,setRegisterData]=useState({username:'',email:'',password:'',confirmPassword:'',full_name:''});const[validationErrors,setValidationErrors]=useState({});const handleLogin=async e=>{e.preventDefault();if(!loginData.username||!loginData.password){message.error('请填写完整信息');return;}setLoading(true);try{await authService.login(loginData);message.success('登录成功！');setLoginData({username:'',password:''});onSuccess();onClose();}catch(error){message.error(error.message||'登录失败');}finally{setLoading(false);}};const handleRegister=async e=>{e.preventDefault();// 详细的前端验证\nif(!registerData.username||!registerData.email||!registerData.password){message.error('请填写完整信息');return;}if(registerData.username.length<3){message.error('用户名至少需要3个字符');return;}if(registerData.username.length>50){message.error('用户名最多50个字符');return;}if(!/^[a-zA-Z0-9_-]+$/.test(registerData.username)){message.error('用户名只能包含字母、数字、下划线和连字符');return;}const emailPattern=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;if(!emailPattern.test(registerData.email)){message.error('请输入有效的邮箱地址');return;}if(registerData.password.length<6){message.error('密码至少需要6个字符');return;}// 检查密码强度（必须包含字母和数字）\nconst hasLetter=/[a-zA-Z]/.test(registerData.password);const hasDigit=/[0-9]/.test(registerData.password);if(!hasLetter||!hasDigit){message.error('密码必须包含字母和数字');return;}if(registerData.password!==registerData.confirmPassword){message.error('两次输入的密码不一致');return;}setLoading(true);try{const{confirmPassword,...submitData}=registerData;await authService.register(submitData);message.success('注册成功！');setRegisterData({username:'',email:'',password:'',confirmPassword:'',full_name:''});setValidationErrors({});onSuccess();onClose();}catch(error){message.error(error.message||'注册失败');}finally{setLoading(false);}};// 实时验证函数\nconst validateField=(field,value)=>{const errors={...validationErrors};switch(field){case'username':if(value.length>0&&value.length<3){errors.username='用户名至少需要3个字符';}else if(value.length>50){errors.username='用户名最多50个字符';}else if(value.length>0&&!/^[a-zA-Z0-9_-]+$/.test(value)){errors.username='只能包含字母、数字、下划线和连字符';}else{delete errors.username;}break;case'email':const emailPattern=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/;if(value.length>0&&!emailPattern.test(value)){errors.email='请输入有效的邮箱地址';}else{delete errors.email;}break;case'password':if(value.length>0&&value.length<6){errors.password='密码至少需要6个字符';}else if(value.length>=6){const hasLetter=/[a-zA-Z]/.test(value);const hasDigit=/[0-9]/.test(value);if(!hasLetter||!hasDigit){errors.password='密码必须包含字母和数字';}else{delete errors.password;}}else{delete errors.password;}break;case'confirmPassword':if(value.length>0&&value!==registerData.password){errors.confirmPassword='两次输入的密码不一致';}else{delete errors.confirmPassword;}break;}setValidationErrors(errors);};const handleCancel=()=>{setLoginData({username:'',password:''});setRegisterData({username:'',email:'',password:'',confirmPassword:'',full_name:''});setValidationErrors({});setActiveTab('login');setLoading(false);onClose();};// 当模态框关闭时重置状态\nReact.useEffect(()=>{if(!visible){setLoginData({username:'',password:''});setRegisterData({username:'',email:'',password:'',confirmPassword:'',full_name:''});setValidationErrors({});setActiveTab('login');setLoading(false);}},[visible]);// 监听ESC键\nuseEffect(()=>{const handleKeyDown=event=>{if(event.key==='Escape'&&visible){handleCancel();}};if(visible){document.addEventListener('keydown',handleKeyDown);// 防止背景滚动\ndocument.body.style.overflow='hidden';}return()=>{document.removeEventListener('keydown',handleKeyDown);document.body.style.overflow='unset';};},[visible]);const loginTab=/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleLogin,children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'20px'},children:/*#__PURE__*/_jsx(Input,{prefix:/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#1890ff'}}),placeholder:\"\\u7528\\u6237\\u540D\\u6216\\u90AE\\u7BB1\",value:loginData.username,onChange:e=>setLoginData({...loginData,username:e.target.value}),size:\"large\",style:{borderRadius:'6px'}})}),/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'24px'},children:/*#__PURE__*/_jsx(Input,{type:\"password\",prefix:/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#1890ff'}}),placeholder:\"\\u5BC6\\u7801\",value:loginData.password,onChange:e=>setLoginData({...loginData,password:e.target.value}),size:\"large\",style:{borderRadius:'6px'}})}),/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'20px'},children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loading,block:true,size:\"large\",style:{borderRadius:'6px',height:'44px',fontSize:'16px',fontWeight:'bold'},children:\"\\u767B\\u5F55\"})})]}),/*#__PURE__*/_jsx(Divider,{style:{margin:'20px 0'},children:/*#__PURE__*/_jsx(\"span\",{style:{color:'#999',fontSize:'14px'},children:\"\\u8FD8\\u6CA1\\u6709\\u8D26\\u53F7\\uFF1F\"})}),/*#__PURE__*/_jsx(Button,{type:\"link\",block:true,onClick:()=>setActiveTab('register'),style:{color:'#1890ff',fontSize:'14px',height:'40px'},children:\"\\u7ACB\\u5373\\u6CE8\\u518C\"})]});const registerTab=/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleRegister,children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px'},children:[/*#__PURE__*/_jsx(Input,{prefix:/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#1890ff'}}),placeholder:\"\\u7528\\u6237\\u540D\\uFF083-50\\u4E2A\\u5B57\\u7B26\\uFF09\",value:registerData.username,onChange:e=>{const value=e.target.value;setRegisterData({...registerData,username:value});validateField('username',value);},size:\"large\",style:{borderRadius:'6px',borderColor:validationErrors.username?'#ff4d4f':undefined}}),validationErrors.username&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#ff4d4f',fontSize:'12px',marginTop:'4px'},children:validationErrors.username})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px'},children:[/*#__PURE__*/_jsx(Input,{prefix:/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#1890ff'}}),placeholder:\"\\u90AE\\u7BB1\\u5730\\u5740\",type:\"email\",value:registerData.email,onChange:e=>{const value=e.target.value;setRegisterData({...registerData,email:value});validateField('email',value);},size:\"large\",style:{borderRadius:'6px',borderColor:validationErrors.email?'#ff4d4f':undefined}}),validationErrors.email&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#ff4d4f',fontSize:'12px',marginTop:'4px'},children:validationErrors.email})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px'},children:[/*#__PURE__*/_jsx(Input,{type:\"password\",prefix:/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#1890ff'}}),placeholder:\"\\u5BC6\\u7801\\uFF08\\u81F3\\u5C116\\u4E2A\\u5B57\\u7B26\\uFF0C\\u5305\\u542B\\u5B57\\u6BCD\\u548C\\u6570\\u5B57\\uFF09\",value:registerData.password,onChange:e=>{const value=e.target.value;setRegisterData({...registerData,password:value});validateField('password',value);// 如果确认密码已输入，也要重新验证\nif(registerData.confirmPassword){validateField('confirmPassword',registerData.confirmPassword);}},size:\"large\",style:{borderRadius:'6px',borderColor:validationErrors.password?'#ff4d4f':undefined}}),validationErrors.password&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#ff4d4f',fontSize:'12px',marginTop:'4px'},children:validationErrors.password})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px'},children:[/*#__PURE__*/_jsx(Input,{type:\"password\",prefix:/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#1890ff'}}),placeholder:\"\\u786E\\u8BA4\\u5BC6\\u7801\",value:registerData.confirmPassword,onChange:e=>{const value=e.target.value;setRegisterData({...registerData,confirmPassword:value});validateField('confirmPassword',value);},size:\"large\",style:{borderRadius:'6px',borderColor:validationErrors.confirmPassword?'#ff4d4f':undefined}}),validationErrors.confirmPassword&&/*#__PURE__*/_jsx(\"div\",{style:{color:'#ff4d4f',fontSize:'12px',marginTop:'4px'},children:validationErrors.confirmPassword})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'20px'},children:/*#__PURE__*/_jsx(Input,{prefix:/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#1890ff'}}),placeholder:\"\\u771F\\u5B9E\\u59D3\\u540D\\uFF08\\u53EF\\u9009\\uFF09\",value:registerData.full_name,onChange:e=>setRegisterData({...registerData,full_name:e.target.value}),size:\"large\",style:{borderRadius:'6px'}})}),/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'20px'},children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",loading:loading,block:true,size:\"large\",style:{borderRadius:'6px',height:'44px',fontSize:'16px',fontWeight:'bold'},children:\"\\u6CE8\\u518C\"})})]}),/*#__PURE__*/_jsx(Divider,{style:{margin:'20px 0'},children:/*#__PURE__*/_jsx(\"span\",{style:{color:'#999',fontSize:'14px'},children:\"\\u5DF2\\u6709\\u8D26\\u53F7\\uFF1F\"})}),/*#__PURE__*/_jsx(Button,{type:\"link\",block:true,onClick:()=>setActiveTab('login'),style:{color:'#1890ff',fontSize:'14px',height:'40px'},children:\"\\u7ACB\\u5373\\u767B\\u5F55\"})]});if(!visible)return null;const modalContent=/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,backgroundColor:'rgba(0, 0, 0, 0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:9999},onClick:e=>{// 点击背景关闭模态框\nif(e.target===e.currentTarget){handleCancel();}},children:/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:'white',borderRadius:'8px',padding:'32px',width:'420px',maxWidth:'90vw',maxHeight:'90vh',overflow:'auto',position:'relative',boxShadow:'0 4px 12px rgba(0, 0, 0, 0.15)'},children:[/*#__PURE__*/_jsx(Button,{onClick:handleCancel,style:{position:'absolute',top:'16px',right:'16px',border:'none',background:'transparent',fontSize:'20px',width:'32px',height:'32px',display:'flex',alignItems:'center',justifyContent:'center',cursor:'pointer'},children:\"\\xD7\"}),/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',fontSize:'24px',fontWeight:'bold',marginBottom:'32px',color:'#1890ff'},children:[activeTab==='login'?'登录':'注册',\" AlgoKG\"]}),/*#__PURE__*/_jsx(\"div\",{children:activeTab==='login'?loginTab:registerTab})]})});return/*#__PURE__*/createPortal(modalContent,document.body);};export default LoginModal;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}