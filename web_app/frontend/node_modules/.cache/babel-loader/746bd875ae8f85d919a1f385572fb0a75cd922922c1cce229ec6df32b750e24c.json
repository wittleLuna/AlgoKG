{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Card,Button,Space,message,Input,Select,Spin,Empty}from'antd';import{FilterOutlined,EyeOutlined,LeftOutlined,SearchOutlined,UserOutlined,NodeIndexOutlined}from'@ant-design/icons';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Search}=Input;const{Option}=Select;const NoteList=_ref=>{let{onNoteSelect,onNoteDelete,onUploadClick,onEntityVisualize}=_ref;const[notes,setNotes]=useState([]);const[loading,setLoading]=useState(false);const[searchQuery,setSearchQuery]=useState('');const[noteTypeFilter,setNoteTypeFilter]=useState('');const[pagination,setPagination]=useState({page:1,size:10,total:0});const noteTypes=[{value:'',label:'全部类型'},{value:'algorithm',label:'算法笔记'},{value:'data_structure',label:'数据结构笔记'},{value:'problem_solving',label:'题解笔记'},{value:'theory',label:'理论笔记'},{value:'general',label:'通用笔记'}];const fetchNotes=async()=>{setLoading(true);try{const token=localStorage.getItem('token');if(!token){message.error('请先登录');return;}const params=new URLSearchParams({page:pagination.page.toString(),size:pagination.size.toString()});if(searchQuery){params.append('search_query',searchQuery);}if(noteTypeFilter){params.append('note_type',noteTypeFilter);}const response=await fetch(`/api/v1/notes/list?${params}`,{headers:{'Authorization':`Bearer ${token}`}});if(!response.ok){const errorData=await response.json();throw new Error(errorData.detail||'获取笔记列表失败');}const data=await response.json();setNotes(data.notes);setPagination(prev=>({...prev,total:data.total}));}catch(error){console.error('获取笔记列表失败:',error);message.error(error.message||'获取笔记列表失败');}finally{setLoading(false);}};useEffect(()=>{fetchNotes();},[pagination.page,pagination.size,searchQuery,noteTypeFilter]);const handleSearch=value=>{setSearchQuery(value);setPagination(prev=>({...prev,page:1}));};const handleTypeFilter=value=>{setNoteTypeFilter(value);setPagination(prev=>({...prev,page:1}));};const handleDelete=async noteId=>{try{const token=localStorage.getItem('token');const response=await fetch(`/api/v1/notes/${noteId}`,{method:'DELETE',headers:{'Authorization':`Bearer ${token}`}});if(!response.ok){throw new Error('删除失败');}message.success('笔记删除成功');fetchNotes();if(onNoteDelete){onNoteDelete(noteId);}}catch(error){message.error(error.message||'删除失败');}};const formatDate=dateString=>{return new Date(dateString).toLocaleString('zh-CN');};const getTypeLabel=type=>{const typeMap={'algorithm':'算法','data_structure':'数据结构','problem_solving':'题解','theory':'理论','general':'通用'};return typeMap[type]||type;};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px',display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:0},children:\"\\u6211\\u7684\\u7B14\\u8BB0\"}),/*#__PURE__*/_jsx(Button,{type:\"primary\",icon:/*#__PURE__*/_jsx(UserOutlined,{}),onClick:onUploadClick,children:\"\\u4E0A\\u4F20\\u7B14\\u8BB0\"})]}),/*#__PURE__*/_jsxs(Space,{size:\"middle\",style:{width:'100%',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Search,{placeholder:\"\\u641C\\u7D22\\u7B14\\u8BB0\\u6807\\u9898\\u6216\\u5185\\u5BB9\",allowClear:true,onSearch:handleSearch,style:{width:300},enterButton:/*#__PURE__*/_jsx(SearchOutlined,{})}),/*#__PURE__*/_jsx(Select,{value:noteTypeFilter,onChange:handleTypeFilter,style:{width:150},children:noteTypes.map(type=>/*#__PURE__*/_jsx(Option,{value:type.value,children:type.label},type.value))})]}),/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u5171 \",pagination.total,\" \\u6761\\u7B14\\u8BB0\"]})]})]}),/*#__PURE__*/_jsx(Spin,{spinning:loading,children:notes.length===0?/*#__PURE__*/_jsx(Empty,{description:\"\\u6682\\u65E0\\u7B14\\u8BB0\",style:{margin:'40px 0'}}):/*#__PURE__*/_jsx(\"div\",{style:{display:'grid',gap:'16px'},children:notes.map(note=>/*#__PURE__*/_jsxs(Card,{size:\"small\",title:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(FilterOutlined,{}),/*#__PURE__*/_jsx(\"span\",{children:note.title}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'12px',color:'#666',backgroundColor:'#f0f0f0',padding:'2px 6px',borderRadius:'4px'},children:getTypeLabel(note.note_type)})]}),extra:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(EyeOutlined,{}),onClick:()=>{console.log('点击查看笔记:',note);if(onNoteSelect){onNoteSelect(note);}else{message.warning('查看功能暂不可用');}},children:\"\\u67E5\\u770B\\u8BE6\\u60C5\"}),note.entities_extracted&&/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(NodeIndexOutlined,{}),onClick:()=>{console.log('点击实体可视化:',note);if(onEntityVisualize){onEntityVisualize(note);}else if(onNoteSelect){onNoteSelect(note);}else{message.warning('实体可视化功能暂不可用');}},style:{color:'#1890ff'},children:\"\\u5B9E\\u4F53\\u56FE\\u8C31\"}),/*#__PURE__*/_jsx(Button,{type:\"text\",danger:true,icon:/*#__PURE__*/_jsx(LeftOutlined,{}),onClick:()=>handleDelete(note.id),children:\"\\u5220\\u9664\"})]}),children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'8px'},children:/*#__PURE__*/_jsx(\"div\",{style:{color:'#666',fontSize:'14px'},children:note.description||'无描述'})}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsx(Space,{size:\"small\",children:note.tags.map((tag,index)=>/*#__PURE__*/_jsx(\"span\",{style:{backgroundColor:'#e6f7ff',color:'#1890ff',padding:'2px 6px',borderRadius:'4px',fontSize:'12px'},children:tag},index))}),/*#__PURE__*/_jsxs(Space,{size:\"small\",style:{fontSize:'12px',color:'#999'},children:[note.entities_extracted?/*#__PURE__*/_jsxs(\"span\",{style:{color:'#52c41a',fontWeight:'bold'},children:[\"\\u2705 \\u5DF2\\u63D0\\u53D6 \",note.entity_count||0,\" \\u4E2A\\u5B9E\\u4F53\"]}):/*#__PURE__*/_jsx(\"span\",{style:{color:'#faad14'},children:\"\\u23F3 \\u672A\\u63D0\\u53D6\\u5B9E\\u4F53\"}),/*#__PURE__*/_jsx(\"span\",{children:formatDate(note.created_at)})]})]})]},note.id))})}),notes.length>0&&/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',marginTop:'20px'},children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{disabled:pagination.page<=1,onClick:()=>setPagination(prev=>({...prev,page:prev.page-1})),children:\"\\u4E0A\\u4E00\\u9875\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u7B2C \",pagination.page,\" \\u9875\\uFF0C\\u5171 \",Math.ceil(pagination.total/pagination.size),\" \\u9875\"]}),/*#__PURE__*/_jsx(Button,{disabled:pagination.page>=Math.ceil(pagination.total/pagination.size),onClick:()=>setPagination(prev=>({...prev,page:prev.page+1})),children:\"\\u4E0B\\u4E00\\u9875\"})]})})]});};export default NoteList;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}