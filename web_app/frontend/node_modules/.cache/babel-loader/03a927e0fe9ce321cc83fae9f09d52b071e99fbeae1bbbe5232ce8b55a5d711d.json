{"ast":null,"code":"import React,{useState}from'react';import{Card,Typography,Tag,Button,Space,Collapse,Rate,message as antdMessage,Tooltip,Spin}from'antd';import{UserOutlined,RobotOutlined,CopyOutlined,LikeOutlined,DislikeOutlined,ExpandAltOutlined,StarOutlined}from'@ant-design/icons';import ReactMarkdown from'react-markdown';import{Prism as SyntaxHighlighter}from'react-syntax-highlighter';import{tomorrow}from'react-syntax-highlighter/dist/esm/styles/prism';import EnhancedReasoningPath from'./EnhancedReasoningPath';import InteractiveContent from'../common/InteractiveContent';import SmartLinkSuggestions from'../common/SmartLinkSuggestions';import SmartTagDisplay from'../common/SmartTagDisplay';import EmbeddedAlgorithmVisualizer from'../visualization/EmbeddedAlgorithmVisualizer';import InlineKnowledgeGraph from'./InlineKnowledgeGraph';import EnhancedSimilarProblems from'./EnhancedSimilarProblems';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";const{Text,Title,Paragraph}=Typography;const{Panel}=Collapse;const MessageItem=_ref=>{let{message,onConceptClick,onProblemClick}=_ref;const[showFullResponse,setShowFullResponse]=useState(false);const[userRating,setUserRating]=useState(0);const[enhancedGraphData,setEnhancedGraphData]=useState(null);const[graphLoading,setGraphLoading]=useState(false);const[isFavorited,setIsFavorited]=useState(false);const isUser=message.type==='user';const response=message.response;// æ£€æŸ¥æ˜¯å¦å·²æ”¶è—\nReact.useEffect(()=>{const favorites=JSON.parse(localStorage.getItem('favorites')||'[]');const messageId=`${message.type}-${message.timestamp}-${message.content.substring(0,50)}`;setIsFavorited(favorites.some(fav=>fav.id===messageId));},[message]);// æ”¶è—/å–æ¶ˆæ”¶è—\nconst handleFavorite=()=>{const favorites=JSON.parse(localStorage.getItem('favorites')||'[]');const messageId=`${message.type}-${message.timestamp}-${message.content.substring(0,50)}`;if(isFavorited){// å–æ¶ˆæ”¶è—\nconst newFavorites=favorites.filter(fav=>fav.id!==messageId);localStorage.setItem('favorites',JSON.stringify(newFavorites));setIsFavorited(false);antdMessage.success('å·²å–æ¶ˆæ”¶è—');}else{// æ·»åŠ æ”¶è—\nconst favoriteItem={id:messageId,type:message.type==='user'?'query':'response',title:message.type==='user'?message.content.substring(0,100):'ç³»ç»Ÿå›ç­”',content:message.content,timestamp:message.timestamp||Date.now(),tags:(response===null||response===void 0?void 0:response.entities)||[],category:(response===null||response===void 0?void 0:response.intent)||'general',metadata:{reasoning_path:response===null||response===void 0?void 0:response.reasoning_path,similar_problems:response===null||response===void 0?void 0:response.similar_problems,response_metadata:response===null||response===void 0?void 0:response.metadata}};const newFavorites=[...favorites,favoriteItem];localStorage.setItem('favorites',JSON.stringify(newFavorites));setIsFavorited(true);antdMessage.success('å·²æ·»åŠ åˆ°æ”¶è—');}};// è·å–å¢å¼ºçš„å›¾è°±æ•°æ®ï¼ˆä½¿ç”¨ä¸ç‹¬ç«‹å›¾è°±é¡µé¢ç›¸åŒçš„APIï¼‰\nconst fetchEnhancedGraphData=async entityName=>{if(!entityName||graphLoading)return;setGraphLoading(true);try{const response=await fetch('/api/v1/graph/unified/query?data_sources=neo4j&data_sources=embedding',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({entity_name:entityName.trim(),depth:2,limit:50})});if(response.ok){const data=await response.json();setEnhancedGraphData(data);console.log(`âœ… è·å–å¢å¼ºå›¾è°±æ•°æ®æˆåŠŸ: ${entityName}`,data);}else{console.error('âŒ è·å–å¢å¼ºå›¾è°±æ•°æ®å¤±è´¥:',response.status);}}catch(error){console.error('âŒ è·å–å¢å¼ºå›¾è°±æ•°æ®é”™è¯¯:',error);}finally{setGraphLoading(false);}};// å½“æœ‰å®ä½“æ—¶è‡ªåŠ¨è·å–å¢å¼ºå›¾è°±æ•°æ®\nReact.useEffect(()=>{if(response!==null&&response!==void 0&&response.entities&&response.entities.length>0&&!enhancedGraphData&&!graphLoading){const mainEntity=response.entities[0];console.log(`ğŸ” æ£€æµ‹åˆ°å®ä½“ï¼Œè·å–å¢å¼ºå›¾è°±æ•°æ®: ${mainEntity}`);fetchEnhancedGraphData(mainEntity);}},[response===null||response===void 0?void 0:response.entities,enhancedGraphData,graphLoading]);// æ£€æµ‹æ˜¯å¦åŒ…å«å¯è§†åŒ–çš„ç®—æ³•ä»£ç \nconst detectAlgorithmCode=(code,language)=>{if(!code||language!=='javascript'&&language!=='js')return null;const algorithmPatterns={bubble_sort:/bubbleSort|å†’æ³¡æ’åº/i,selection_sort:/selectionSort|é€‰æ‹©æ’åº/i,insertion_sort:/insertionSort|æ’å…¥æ’åº/i,quick_sort:/quickSort|å¿«é€Ÿæ’åº/i,merge_sort:/mergeSort|å½’å¹¶æ’åº/i,binary_search:/binarySearch|äºŒåˆ†æŸ¥æ‰¾/i};for(const[algorithm,pattern]of Object.entries(algorithmPatterns)){if(pattern.test(code)){return algorithm;}}return null;};// æå–æ•°ç»„æ•°æ®\nconst extractArrayData=code=>{const arrayMatch=code.match(/\\[[\\d\\s,]+\\]/);if(arrayMatch){try{return JSON.parse(arrayMatch[0]);}catch(e){// å¿½ç•¥è§£æé”™è¯¯\n}}return[64,34,25,12,22,11,90];// é»˜è®¤æ•°æ®\n};// æ·±åº¦è°ƒè¯•å‡½æ•°\nconst debugData=(data,name)=>{console.log(`=== ${name} è°ƒè¯•ä¿¡æ¯ ===`);console.log('ç±»å‹:',typeof data);console.log('å€¼:',data);if(data&&typeof data==='object'){console.log('é”®:',Object.keys(data));console.log('JSON:',JSON.stringify(data,null,2));}console.log('========================');};// è°ƒè¯•æ¶ˆæ¯å’Œå“åº”æ•°æ®\nReact.useEffect(()=>{debugData(message,'Message');debugData(message.content,'Message Content');debugData(response,'Response');if(response){debugData(response.integrated_response,'Integrated Response');debugData(response.concept_explanation,'Concept Explanation');}},[message,response]);// å®‰å…¨æ¸²æŸ“å‡½æ•°ï¼Œå¤„ç†å¯¹è±¡æ˜¾ç¤ºé—®é¢˜\nconst safeRender=value=>{if(value===null||value===undefined){return'';}if(typeof value==='string'){return value;}if(typeof value==='number'||typeof value==='boolean'){return String(value);}if(Array.isArray(value)){return value.map(item=>safeRender(item)).filter(Boolean).join(', ');}if(value&&typeof value==='object'){// æ£€æŸ¥æ˜¯å¦æ˜¯Reactå…ƒç´ \nif(value.$$typeof){return'[React Element]';}// ç‰¹æ®Šå¤„ç†Neo4jèŠ‚ç‚¹å¯¹è±¡\nif(value.element_id&&value.labels&&value.properties){const props=value.properties;const name=props.name||props.title||props.concept_name||'æœªçŸ¥ç®—æ³•';const description=props.description||'';const category=props.category||'';// è¿”å›ç¾åŒ–çš„èŠ‚ç‚¹ä¿¡æ¯\nreturn`**${name}**${category?` (${category})`:''}${description?` - ${description}`:''}`;}// ç‰¹æ®Šå¤„ç†å¸¸è§çš„å¯¹è±¡ç±»å‹ - æŒ‰ä¼˜å…ˆçº§æ’åº\nif(value.name&&typeof value.name==='string')return value.name;if(value.title&&typeof value.title==='string')return value.title;if(value.text&&typeof value.text==='string')return value.text;if(value.content&&typeof value.content==='string')return value.content;if(value.label&&typeof value.label==='string')return value.label;if(value.description&&typeof value.description==='string')return value.description;if(value.concept_name&&typeof value.concept_name==='string')return value.concept_name;if(value.algorithm&&typeof value.algorithm==='string')return value.algorithm;// å¦‚æœå¯¹è±¡åªæœ‰ä¸€ä¸ªå±æ€§ï¼Œè¿”å›è¯¥å±æ€§çš„å€¼\nconst keys=Object.keys(value);if(keys.length===1){return safeRender(value[keys[0]]);}// å¯¹äºå¤æ‚å¯¹è±¡ï¼Œå°è¯•æå–æœ‰æ„ä¹‰çš„ä¿¡æ¯\nif(keys.includes('algorithm')&&keys.includes('description')){return`${safeRender(value.algorithm)}: ${safeRender(value.description)}`;}if(keys.includes('concept')&&keys.includes('explanation')){return`${safeRender(value.concept)} - ${safeRender(value.explanation)}`;}if(keys.includes('concept_name')&&keys.includes('definition')){return`${safeRender(value.concept_name)}: ${safeRender(value.definition)}`;}// å°è¯•æ‰¾åˆ°æœ€æœ‰æ„ä¹‰çš„å­—ç¬¦ä¸²å±æ€§\nconst meaningfulKeys=keys.filter(key=>typeof value[key]==='string'&&value[key].length>0&&!['id','created_at','updated_at','$$typeof'].includes(key));if(meaningfulKeys.length>0){return safeRender(value[meaningfulKeys[0]]);}// æœ€åè¿”å›ç®€åŒ–çš„æè¿°è€Œä¸æ˜¯[object Object]\nreturn keys.length>0?`{${keys.slice(0,2).join(', ')}}`:'{}';}return String(value||'');};// å®‰å…¨æ¸²æŸ“æ•°ç»„\nconst safeRenderArray=arr=>{if(!Array.isArray(arr)){return[safeRender(arr)];}return arr.map(item=>safeRender(item));};// æ·±åº¦æ¸…ç†å¯¹è±¡å¼•ç”¨çš„å‡½æ•°\nconst deepCleanObjectReferences=text=>{return text// æ¸…ç†å„ç§å¯¹è±¡å¼•ç”¨æ¨¡å¼\n.replace(/\\[object Object\\]/g,'').replace(/\\{object Object\\}/g,'').replace(/Object\\s*\\{\\s*\\}/g,'').replace(/\\{\\s*\\[object Object\\]\\s*\\}/g,'').replace(/\\[\\s*\\[object Object\\]\\s*\\]/g,'')// æ¸…ç†ç©ºçš„æ•°æ®ç»“æ„\n.replace(/\\{\\s*\\}/g,'').replace(/\\[\\s*\\]/g,'').replace(/\\(\\s*\\)/g,'')// æ¸…ç†å¤šä½™çš„æ ‡ç‚¹ç¬¦å·\n.replace(/,\\s*,/g,',').replace(/:\\s*,/g,'').replace(/,\\s*:/g,':')// æ¸…ç†å¤šä½™çš„ç©ºç™½\n.replace(/\\s{3,}/g,'  ').replace(/\\n\\s*\\n\\s*\\n/g,'\\n\\n').trim();};// å¤„ç†æ¶ˆæ¯å†…å®¹ï¼Œæ›¿æ¢å¯èƒ½çš„å¯¹è±¡å¼•ç”¨\nconst processMessageContent=content=>{if(!content)return'';console.log('MessageItem - åŸå§‹æ¶ˆæ¯å†…å®¹:',content);console.log('MessageItem - å†…å®¹ç±»å‹:',typeof content);// ç®€åŒ–å¤„ç†é€»è¾‘ï¼Œé¿å…è¿‡åº¦å¤æ‚åŒ–\nlet processedContent='';// å¤„ç†ä¸åŒç±»å‹çš„å†…å®¹\nif(typeof content==='string'){processedContent=content;}else if(content&&typeof content==='object'){// å¦‚æœå†…å®¹æ˜¯å¯¹è±¡ï¼Œå°è¯•æå–æœ‰æ„ä¹‰çš„ä¿¡æ¯\nif(content.integrated_response){processedContent=String(content.integrated_response);}else if(content.content){processedContent=String(content.content);}else if(content.text){processedContent=String(content.text);}else{// å¯¹äºå…¶ä»–å¯¹è±¡ï¼Œä½¿ç”¨ç®€å•çš„å­—ç¬¦ä¸²è½¬æ¢\nprocessedContent=JSON.stringify(content,null,2);}}else{processedContent=String(content||'');}// é¦–å…ˆå¤„ç†Neo4jèŠ‚ç‚¹å¯¹è±¡çš„æ˜¾ç¤º - åœ¨å…¶ä»–æ¸…ç†ä¹‹å‰è¿›è¡Œ\nprocessedContent=processedContent// å¤„ç†å®Œæ•´çš„Neo4jèŠ‚ç‚¹æ ¼å¼\n.replace(/<Node element_id='(\\d+)' labels=frozenset\\(\\{[^}]*\\}\\) properties=\\{([^}]+)\\}>/g,(match,elementId,propertiesStr)=>{console.log('Neo4jèŠ‚ç‚¹åŒ¹é…:',match);console.log('å±æ€§å­—ç¬¦ä¸²:',propertiesStr);try{// å°è¯•è§£æå±æ€§å­—ç¬¦ä¸² - æ›´ç²¾ç¡®çš„åŒ¹é…\nconst nameMatch=propertiesStr.match(/'name':\\s*'([^']+)'/);const descMatch=propertiesStr.match(/'description':\\s*'([^']+)'/);const categoryMatch=propertiesStr.match(/'category':\\s*'([^']+)'/);const difficultyMatch=propertiesStr.match(/'difficulty':\\s*'([^']+)'/);const platformMatch=propertiesStr.match(/'platform':\\s*'([^']+)'/);const tagsMatch=propertiesStr.match(/'tags':\\s*\\[([^\\]]*)\\]/);const titleMatch=propertiesStr.match(/'title':\\s*'([^']+)'/);const name=nameMatch?nameMatch[1]:titleMatch?titleMatch[1]:'æœªçŸ¥å†…å®¹';const description=descMatch?descMatch[1]:'';const category=categoryMatch?categoryMatch[1]:'';const difficulty=difficultyMatch?difficultyMatch[1]:'';const platform=platformMatch?platformMatch[1]:'';console.log('è§£æç»“æœ:',{name,description,category,difficulty,platform});// è¿‡æ»¤æ‰SolutionèŠ‚ç‚¹ï¼Œåªæ˜¾ç¤ºæœ‰æ„ä¹‰çš„èŠ‚ç‚¹\nconst isSolutionNode=match.includes(\"'Solution'\")||match.includes('\"Solution\"');if(isSolutionNode){console.log('è·³è¿‡SolutionèŠ‚ç‚¹');return'';// ä¸æ˜¾ç¤ºSolutionèŠ‚ç‚¹\n}// æ£€æŸ¥æ˜¯å¦æ˜¯é¢˜ç›®èŠ‚ç‚¹ï¼ˆé€šè¿‡æ ‡ç­¾æˆ–å­—æ®µåˆ¤æ–­ï¼‰\nconst isAlgorithmNode=match.includes(\"'Algorithm'\")||match.includes('\"Algorithm\"');const isProblemNode=match.includes(\"'Problem'\")||match.includes('\"Problem\"')||difficulty||platform||name.includes('è·¯å¾„')||name.includes('é—®é¢˜')||name.includes('é¢˜ç›®');if(isProblemNode&&!isAlgorithmNode){// é¢˜ç›®èŠ‚ç‚¹çš„æ ¼å¼åŒ–æ˜¾ç¤º\nlet result=`\\n\\n> ğŸ“ **${name}**`;// æ·»åŠ éš¾åº¦æ ‡ç­¾\nif(difficulty){const difficultyColor=difficulty==='ç®€å•'?'ğŸŸ¢':difficulty==='ä¸­ç­‰'?'ğŸŸ¡':'ğŸ”´';result+=` ${difficultyColor} \\`${difficulty}\\``;}// æ·»åŠ å¹³å°æ ‡ç­¾\nif(platform){result+=` ğŸ·ï¸ \\`${platform}\\``;}// æ·»åŠ æè¿°\nif(description){result+=`\\n> \\n> ${description}`;}// æ·»åŠ åˆ†ç±»\nif(category){result+=`\\n> \\n> ğŸ·ï¸ **åˆ†ç±»**: ${category}`;}console.log('é¢˜ç›®èŠ‚ç‚¹æ ¼å¼åŒ–ç»“æœ:',result);return result+'\\n';}else{// ç®—æ³•èŠ‚ç‚¹çš„æ ¼å¼åŒ–æ˜¾ç¤º\nconst result=`\\n\\n> ğŸ” **${name}**${category?` \\`${category}\\``:''}\\n> \\n> ${description||'ç›¸å…³ç®—æ³•æ¦‚å¿µ'}\\n`;console.log('ç®—æ³•èŠ‚ç‚¹æ ¼å¼åŒ–ç»“æœ:',result);return result;}}catch(e){console.error('Neo4jèŠ‚ç‚¹è§£æé”™è¯¯:',e);return`\\n\\n> ğŸ” **ç›¸å…³å†…å®¹**\\n`;}})// å¤„ç†ç®€åŒ–çš„Neo4jèŠ‚ç‚¹æ ¼å¼ï¼ˆåªæœ‰å±æ€§éƒ¨åˆ†ï¼‰\n.replace(/\\{[^}]*'name':\\s*'([^']+)'[^}]*'description':\\s*'([^']*)'[^}]*'category':\\s*'([^']*)'[^}]*\\}/g,(match,name,description,category)=>{console.log('ç®€åŒ–èŠ‚ç‚¹åŒ¹é…:',{name,description,category});return`\\n\\n> ğŸ” **${name}**${category?` \\`${category}\\``:''}\\n> \\n> ${description||'ç›¸å…³æ¦‚å¿µ'}\\n`;})// å¤„ç†æ•°ç»„ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ï¼ˆå¦‚ +12ä¸ªï¼‰\n.replace(/\\+(\\d+)ä¸ª/g,(match,count)=>{return`ç­‰${count}ä¸ªç›¸å…³å†…å®¹`;})// å¤„ç†å•ç‹¬çš„èŠ‚ç‚¹å±æ€§æ˜¾ç¤º\n.replace(/properties=\\{([^}]+)\\}/g,(match,propertiesStr)=>{try{const nameMatch=propertiesStr.match(/'name':\\s*'([^']+)'/);const descMatch=propertiesStr.match(/'description':\\s*'([^']+)'/);const categoryMatch=propertiesStr.match(/'category':\\s*'([^']+)'/);if(nameMatch){const name=nameMatch[1];const description=descMatch?descMatch[1]:'';const category=categoryMatch?categoryMatch[1]:'';return`**${name}**${category?` (${category})`:''}${description?` - ${description}`:''}`;}}catch(e){console.error('å±æ€§è§£æé”™è¯¯:',e);}return'ç›¸å…³å†…å®¹';});// åœ¨Neo4jèŠ‚ç‚¹å¤„ç†å®Œæˆåï¼Œè¿›è¡Œå…¶ä»–æ¸…ç†\nprocessedContent=processedContent// æ¸…ç†å¯¹è±¡å¼•ç”¨\n.replace(/\\[object Object\\]/g,'ç›¸å…³å†…å®¹').replace(/\\{object Object\\}/g,'ç›¸å…³å†…å®¹').replace(/Object\\s*\\{\\s*\\}/g,'')// æ¸…ç†å¤šä½™çš„ç¬¦å·å’Œç©ºå€¼ï¼Œä½†ä¿ç•™Markdownæ ¼å¼\n.replace(/\\{\\}/g,'').replace(/\\[\\]/g,'').replace(/\\bundefined\\b/g,'')// åªæ›¿æ¢ç‹¬ç«‹çš„undefinedå•è¯\n.replace(/\\bnull\\b/g,'')// åªæ›¿æ¢ç‹¬ç«‹çš„nullå•è¯\n.replace(/,\\s*:/g,':').replace(/:\\s*,/g,'').replace(/,\\s*,/g,',')// æ¸…ç†\"ç›¸ä¼¼é¢˜ç›®æ¨èï¼šæ— \"ç­‰æ— æ•ˆæ¨èä¿¡æ¯\n.replace(/ç›¸ä¼¼é¢˜ç›®æ¨è\\s*[:ï¼š]\\s*æ— \\s*/g,'').replace(/ç›¸ä¼¼é¢˜ç›®æ¨è\\s*[:ï¼š]\\s*æš‚æ— \\s*/g,'').replace(/ç›¸ä¼¼é¢˜ç›®æ¨è\\s*[:ï¼š]\\s*\\n\\s*æ— \\s*/g,'').replace(/##?\\s*ç›¸ä¼¼é¢˜ç›®æ¨è\\s*\\n\\s*æ— \\s*/g,'').replace(/##?\\s*ç›¸ä¼¼é¢˜ç›®æ¨è\\s*\\n\\s*æš‚æ— \\s*/g,'')// ä¿ç•™Markdownæ ¼å¼ï¼šåªåˆå¹¶è¡Œå†…çš„å¤šä¸ªç©ºæ ¼ï¼Œä¿ç•™æ¢è¡Œå’Œç¼©è¿›\n.replace(/[ \\t]+/g,' ')// åˆå¹¶è¡Œå†…çš„ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦\n.replace(/\\n[ \\t]+\\n/g,'\\n\\n')// æ¸…ç†ç©ºè¡Œä¸­çš„ç©ºæ ¼\n.replace(/\\n{3,}/g,'\\n\\n')// åˆå¹¶è¶…è¿‡2ä¸ªçš„è¿ç»­æ¢è¡Œ\n.trim();// æœ€åæ£€æŸ¥ï¼šå¦‚æœå†…å®¹ä¸ºç©ºæˆ–ä»æœ‰é—®é¢˜ï¼Œæä¾›é»˜è®¤å†…å®¹\nif(!processedContent||processedContent.trim()===''||processedContent.trim()==='undefined'){processedContent='æ­£åœ¨ç”Ÿæˆå›ç­”...';}console.log('å¤„ç†åçš„å†…å®¹:',processedContent);return processedContent;};const handleCopy=text=>{navigator.clipboard.writeText(text);antdMessage.success('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');};const handleConceptClick=concept=>{if(onConceptClick){onConceptClick(concept);}};const handleProblemClick=problem=>{if(onProblemClick){onProblemClick(problem);}};// è·å–å¯ç‚¹å‡»çš„æ¦‚å¿µå’Œé¢˜ç›®\nconst getClickableItems=()=>{var _response$concept_exp,_response$concept_exp2,_response$concept_exp3,_response$concept_exp4,_response$concept_exp5,_response$example_pro,_response$similar_pro,_response$example_pro2,_response$similar_pro2;// ä»å¤šä¸ªæ¥æºæ”¶é›†å¯ç‚¹å‡»æ¦‚å¿µ\nconst conceptSources=[// 1. æ¦‚å¿µè§£é‡Šä¸­çš„å¯ç‚¹å‡»æ¦‚å¿µ\n...((response===null||response===void 0?void 0:(_response$concept_exp=response.concept_explanation)===null||_response$concept_exp===void 0?void 0:_response$concept_exp.clickable_concepts)||[]),// 2. å­¦ä¹ è¿›é˜¶ä¸­çš„å‰ç½®å’Œåç»­æ¦‚å¿µ\n...((response===null||response===void 0?void 0:(_response$concept_exp2=response.concept_explanation)===null||_response$concept_exp2===void 0?void 0:(_response$concept_exp3=_response$concept_exp2.learning_progression)===null||_response$concept_exp3===void 0?void 0:_response$concept_exp3.prerequisites)||[]),...((response===null||response===void 0?void 0:(_response$concept_exp4=response.concept_explanation)===null||_response$concept_exp4===void 0?void 0:(_response$concept_exp5=_response$concept_exp4.learning_progression)===null||_response$concept_exp5===void 0?void 0:_response$concept_exp5.next_concepts)||[]),// 3. ä»å®ä½“åˆ—è¡¨ä¸­æå–\n...((response===null||response===void 0?void 0:response.entities)||[]),// 4. ä»é¢˜ç›®æ ‡ç­¾ä¸­æå–ç®—æ³•å’Œæ•°æ®ç»“æ„æ¦‚å¿µ\n...((response===null||response===void 0?void 0:(_response$example_pro=response.example_problems)===null||_response$example_pro===void 0?void 0:_response$example_pro.flatMap(p=>[...(p.algorithm_tags||[]),...(p.data_structure_tags||[]),...(p.technique_tags||[])]))||[]),// 5. ä»ç›¸ä¼¼é¢˜ç›®çš„å…±äº«æ ‡ç­¾ä¸­æå–\n...((response===null||response===void 0?void 0:(_response$similar_pro=response.similar_problems)===null||_response$similar_pro===void 0?void 0:_response$similar_pro.flatMap(p=>p.shared_tags||[]))||[]),// 6. å¸¸è§ç®—æ³•æ¦‚å¿µï¼ˆç¡¬ç¼–ç çš„é‡è¦æ¦‚å¿µï¼‰\n'æ·±åº¦ä¼˜å…ˆæœç´¢','å¹¿åº¦ä¼˜å…ˆæœç´¢','åŠ¨æ€è§„åˆ’','è´ªå¿ƒç®—æ³•','å›æº¯ç®—æ³•','åˆ†æ²»ç®—æ³•','äºŒåˆ†æŸ¥æ‰¾','åŒæŒ‡é’ˆ','æ»‘åŠ¨çª—å£','æœ€çŸ­è·¯å¾„ç®—æ³•','Dijkstra','Floyd-Warshall','æœ€å°ç”Ÿæˆæ ‘','Prim','Kruskal','äºŒå‰æ ‘','é“¾è¡¨','æ ˆ','é˜Ÿåˆ—','å †','å“ˆå¸Œè¡¨','å›¾','å­—å…¸æ ‘','å¹¶æŸ¥é›†','çº¿æ®µæ ‘'];// å»é‡å¹¶è¿‡æ»¤ç©ºå€¼\nconst filteredSources=conceptSources.filter(Boolean);const uniqueSet=new Set(filteredSources);const concepts=Array.from(uniqueSet);const problems=[...((response===null||response===void 0?void 0:(_response$example_pro2=response.example_problems)===null||_response$example_pro2===void 0?void 0:_response$example_pro2.map(p=>p.title))||[]),...((response===null||response===void 0?void 0:(_response$similar_pro2=response.similar_problems)===null||_response$similar_pro2===void 0?void 0:_response$similar_pro2.map(p=>p.title))||[])];return{concepts,problems};};const renderProblemCard=(problem,index)=>/*#__PURE__*/_jsx(Tooltip,{title:\"\\u70B9\\u51FB\\u67E5\\u770B\\u9898\\u76EE\\u8BE6\\u60C5\",placement:\"top\",children:/*#__PURE__*/_jsxs(Card,{size:\"small\",className:\"problem-card\",hoverable:true,onClick:()=>handleProblemClick(problem.title),style:{marginBottom:8,cursor:'pointer',transition:'all 0.3s ease'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"problem-header\",children:[/*#__PURE__*/_jsxs(Title,{level:5,style:{margin:0,color:'#1890ff'},children:[\"\\uD83D\\uDD17 \",problem.title]}),/*#__PURE__*/_jsxs(Space,{children:[problem.difficulty&&/*#__PURE__*/_jsx(Tag,{color:problem.difficulty==='ç®€å•'?'green':problem.difficulty==='ä¸­ç­‰'?'orange':'red',children:problem.difficulty}),problem.platform&&/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:problem.platform})]})]}),problem.description&&/*#__PURE__*/_jsx(Paragraph,{ellipsis:{rows:2,expandable:true},style:{marginTop:8,marginBottom:8},children:problem.description}),/*#__PURE__*/_jsxs(\"div\",{className:\"problem-tags\",children:[problem.algorithm_tags.map(tag=>/*#__PURE__*/_jsx(Tag,{color:\"purple\",size:\"small\",children:tag},tag)),problem.data_structure_tags.map(tag=>/*#__PURE__*/_jsx(Tag,{color:\"cyan\",size:\"small\",children:tag},tag))]})]},index)});const renderSimilarProblem=(similar,index)=>/*#__PURE__*/_jsx(Tooltip,{title:\"\\u70B9\\u51FB\\u67E5\\u770B\\u9898\\u76EE\\u8BE6\\u60C5\",placement:\"top\",children:/*#__PURE__*/_jsxs(Card,{size:\"small\",className:\"similar-problem-card\",hoverable:true,onClick:()=>handleProblemClick(similar.title),style:{marginBottom:8,cursor:'pointer',transition:'all 0.3s ease'},children:[/*#__PURE__*/_jsxs(\"div\",{className:\"similar-header\",children:[/*#__PURE__*/_jsxs(Title,{level:5,style:{margin:0,color:'#1890ff'},children:[\"\\uD83D\\uDD17 \",similar.title]}),/*#__PURE__*/_jsxs(\"div\",{className:\"similarity-score\",children:[/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"\\u76F8\\u4F3C\\u5EA6: \"}),/*#__PURE__*/_jsxs(Text,{strong:true,children:[Math.min(similar.hybrid_score*100,100).toFixed(1),\"%\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"recommendation-info\",children:[/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"\\u63A8\\u8350\\u7406\\u7531: \"}),/*#__PURE__*/_jsx(Text,{children:similar.recommendation_reason})]}),similar.learning_path&&/*#__PURE__*/_jsxs(\"div\",{className:\"learning-path\",children:[/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"\\u5B66\\u4E60\\u8DEF\\u5F84: \"}),/*#__PURE__*/_jsx(Text,{italic:true,children:similar.learning_path})]}),/*#__PURE__*/_jsx(\"div\",{className:\"shared-tags\",children:/*#__PURE__*/_jsx(SmartTagDisplay,{tags:similar.shared_tags,maxTags:6,size:\"small\",showTooltip:true})})]},index)});if(isUser){return/*#__PURE__*/_jsxs(\"div\",{className:\"message-item user-message\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"message-avatar\",children:/*#__PURE__*/_jsx(UserOutlined,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"message-content\",children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsx(Text,{children:message.content})})}),/*#__PURE__*/_jsx(\"style\",{jsx:true,children:`\n          .message-item {\n            display: flex;\n            margin-bottom: 16px;\n            align-items: flex-start;\n          }\n          \n          .user-message {\n            flex-direction: row-reverse;\n          }\n          \n          .message-avatar {\n            width: 40px;\n            height: 40px;\n            border-radius: 50%;\n            background: #1890ff;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            color: white;\n            margin: 0 12px;\n            flex-shrink: 0;\n          }\n          \n          .message-content {\n            flex: 1;\n            max-width: 70%;\n          }\n        `})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"message-item assistant-message\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"message-avatar\",children:/*#__PURE__*/_jsx(RobotOutlined,{})}),/*#__PURE__*/_jsx(\"div\",{className:\"message-content\",children:/*#__PURE__*/_jsxs(Card,{className:`response-card ${message.isCancelled?'cancelled-message':''}`,children:[message.isCancelled&&/*#__PURE__*/_jsxs(\"div\",{className:\"cancelled-notice\",children:[/*#__PURE__*/_jsx(Tag,{color:\"orange\",children:\"\\u56DE\\u7B54\\u5DF2\\u53D6\\u6D88\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",style:{marginLeft:8},children:\"\\u7528\\u6237\\u53D6\\u6D88\\u4E86\\u6B64\\u6B21\\u56DE\\u7B54\"})]}),!message.isCancelled&&(()=>{console.log('MessageItem - æ£€æŸ¥æ¨ç†æ­¥éª¤:',message.reasoning_steps);console.log('MessageItem - æ¨ç†æ­¥éª¤é•¿åº¦:',Array.isArray(message.reasoning_steps)?message.reasoning_steps.length:0);return Array.isArray(message.reasoning_steps)&&message.reasoning_steps.length>0;})()&&/*#__PURE__*/_jsx(\"div\",{className:\"reasoning-section\",children:/*#__PURE__*/_jsx(EnhancedReasoningPath,{steps:message.reasoning_steps,isStreaming:message.isStreaming,onStepClick:step=>{console.log('Step clicked:',step);// å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ­¥éª¤ç‚¹å‡»å¤„ç†é€»è¾‘\n}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"main-response\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"response-header\",children:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"AI\\u52A9\\u624B\\u56DE\\u7B54\"}),response&&/*#__PURE__*/_jsxs(Tag,{color:\"green\",children:[\"\\u7F6E\\u4FE1\\u5EA6: \",(response.confidence*100).toFixed(1),\"%\"]})]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(CopyOutlined,{}),onClick:()=>handleCopy(message.content),size:\"small\"}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(StarOutlined,{style:{color:isFavorited?'#faad14':undefined}}),onClick:handleFavorite,size:\"small\",title:isFavorited?'å–æ¶ˆæ”¶è—':'æ”¶è—'}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(ExpandAltOutlined,{}),onClick:()=>setShowFullResponse(!showFullResponse),size:\"small\"})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"response-content\",children:/*#__PURE__*/_jsx(ReactMarkdown,{components:{code(_ref2){let{node,inline,className,children,...props}=_ref2;const match=/language-(\\w+)/.exec(className||'');const codeContent=String(children).replace(/\\n$/,'');const language=match?match[1]:'';const detectedAlgorithm=detectAlgorithmCode(codeContent,language);if(!inline&&match){return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:16},children:[/*#__PURE__*/_jsx(SyntaxHighlighter,{style:tomorrow,language:language,PreTag:\"div\",...props,children:codeContent}),detectedAlgorithm&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:12},children:/*#__PURE__*/_jsx(EmbeddedAlgorithmVisualizer,{code:codeContent,algorithm:detectedAlgorithm,data:extractArrayData(codeContent),height:180,autoPlay:true})})]});}else{return/*#__PURE__*/_jsx(\"code\",{className:className,...props,children:children});}},// è‡ªå®šä¹‰æ–‡æœ¬æ¸²æŸ“ä»¥æ”¯æŒäº¤äº’å¼å†…å®¹\np(_ref3){var _children$props;let{children}=_ref3;console.log('ReactMarkdown p children:',children);console.log('ReactMarkdown p children type:',typeof children);console.log('ReactMarkdown p children Array.isArray:',Array.isArray(children));// æ­£ç¡®å¤„ç†childrenå‚æ•°\nlet content='';if(typeof children==='string'){content=children;}else if(Array.isArray(children)){content=children.map(child=>{var _child$props;return typeof child==='string'?child:typeof child==='object'&&child!==null&&child!==void 0&&(_child$props=child.props)!==null&&_child$props!==void 0&&_child$props.children?child.props.children:'';}).join('');}else if(children&&typeof children==='object'&&(_children$props=children.props)!==null&&_children$props!==void 0&&_children$props.children){content=String(children.props.children);}else{content=String(children||'');}console.log('ReactMarkdown p processed content:',content);const{concepts,problems}=getClickableItems();return/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(InteractiveContent,{content:content,clickableConcepts:concepts,clickableProblems:problems,onConceptClick:handleConceptClick,onProblemClick:handleProblemClick,onCodeClick:code=>{navigator.clipboard.writeText(code);antdMessage.success('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');}})});}},children:processMessageContent(message.content)})}),(enhancedGraphData&&enhancedGraphData.nodes&&enhancedGraphData.nodes.length>0||(response===null||response===void 0?void 0:response.graph_data)&&Array.isArray(response.graph_data.nodes)&&response.graph_data.nodes.length>0)&&response.entities&&response.entities.length>0&&/*#__PURE__*/_jsx(InlineKnowledgeGraph,{graphData:enhancedGraphData||response.graph_data,entities:response.entities,showAnimation:false,isEnhanced:!!enhancedGraphData,onNodeClick:(nodeId,nodeData)=>{console.log('å›¾è°±èŠ‚ç‚¹ç‚¹å‡»:',nodeId,nodeData);// å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ èŠ‚ç‚¹ç‚¹å‡»å¤„ç†é€»è¾‘\n},onExpandClick:()=>{console.log('è·³è½¬åˆ°å®Œæ•´å›¾è°±é¡µé¢');// å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ è·³è½¬åˆ°å®Œæ•´å›¾è°±é¡µé¢çš„é€»è¾‘\n}}),graphLoading&&response.entities&&response.entities.length>0&&/*#__PURE__*/_jsx(\"div\",{style:{padding:'16px',textAlign:'center',background:'#f0f9ff',borderRadius:'8px',margin:'16px 0'},children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Spin,{size:\"small\"}),/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"\\u6B63\\u5728\\u52A0\\u8F7D\\u589E\\u5F3A\\u56FE\\u8C31\\u6570\\u636E...\"})]})})]}),response&&showFullResponse&&/*#__PURE__*/_jsxs(Collapse,{className:\"response-details\",ghost:true,children:[response.concept_explanation&&/*#__PURE__*/_jsx(Panel,{header:\"\\u6982\\u5FF5\\u89E3\\u91CA\\u8BE6\\u60C5\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"concept-details\",children:[/*#__PURE__*/_jsx(Title,{level:4,children:safeRender(response.concept_explanation.concept_name)||'æ¦‚å¿µè§£é‡Š'}),/*#__PURE__*/_jsx(Paragraph,{children:safeRender(response.concept_explanation.definition)}),Array.isArray(response.concept_explanation.core_principles)&&response.concept_explanation.core_principles.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Text,{strong:true,children:\"\\u6838\\u5FC3\\u539F\\u7406:\"}),/*#__PURE__*/_jsx(\"ul\",{children:response.concept_explanation.core_principles.map((principle,i)=>/*#__PURE__*/_jsx(\"li\",{children:safeRender(principle)},i))})]})]})},\"concept\"),Array.isArray(response.example_problems)&&response.example_problems.length>0&&/*#__PURE__*/_jsx(Panel,{header:`ç¤ºä¾‹é¢˜ç›® (${response.example_problems.length}é“)`,children:/*#__PURE__*/_jsx(\"div\",{className:\"example-problems\",children:response.example_problems.map((problem,index)=>renderProblemCard(problem,index))})},\"examples\"),Array.isArray(response.similar_problems)&&response.similar_problems.length>0&&response.similar_problems.some(p=>p.title&&p.title!=='æ— '&&p.title.trim()!=='')&&/*#__PURE__*/_jsx(Panel,{header:\"\\uD83C\\uDFAF \\u667A\\u80FD\\u63A8\\u8350\",children:/*#__PURE__*/_jsx(EnhancedSimilarProblems,{problems:response.similar_problems.filter(p=>p.title&&p.title!=='æ— '&&p.title.trim()!==''),onProblemClick:handleProblemClick,maxDisplay:6})},\"similar\")]}),/*#__PURE__*/_jsx(SmartLinkSuggestions,{response:response,onConceptClick:handleConceptClick,onProblemClick:handleProblemClick}),/*#__PURE__*/_jsx(\"div\",{className:\"feedback-section\",children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Text,{type:\"secondary\",children:\"\\u8FD9\\u4E2A\\u56DE\\u7B54\\u5BF9\\u60A8\\u6709\\u5E2E\\u52A9\\u5417\\uFF1F\"}),/*#__PURE__*/_jsx(Rate,{value:userRating,onChange:setUserRating,style:{fontSize:16}}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(LikeOutlined,{}),size:\"small\"}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(DislikeOutlined,{}),size:\"small\"})]})})]})}),/*#__PURE__*/_jsx(\"style\",{jsx:true,children:`\n        .message-item {\n          display: flex;\n          margin-bottom: 24px;\n          align-items: flex-start;\n        }\n        \n        .message-avatar {\n          width: 40px;\n          height: 40px;\n          border-radius: 50%;\n          background: #52c41a;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: white;\n          margin: 0 12px;\n          flex-shrink: 0;\n        }\n        \n        .message-content {\n          flex: 1;\n          max-width: 85%;\n        }\n        \n        .response-card {\n          border-radius: 12px;\n          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n        }\n\n        .cancelled-message {\n          opacity: 0.7;\n          border: 1px solid #faad14;\n          background-color: #fffbe6;\n        }\n\n        .cancelled-notice {\n          margin-bottom: 12px;\n          padding: 8px 12px;\n          background-color: #fff7e6;\n          border: 1px solid #ffd591;\n          border-radius: 6px;\n          display: flex;\n          align-items: center;\n        }\n        \n        .reasoning-section {\n          margin-bottom: 16px;\n          padding-bottom: 16px;\n          border-bottom: 1px solid #f0f0f0;\n        }\n        \n        .response-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          margin-bottom: 12px;\n          padding-bottom: 8px;\n          border-bottom: 1px solid #f0f0f0;\n        }\n        \n        .response-content {\n          line-height: 1.6;\n          color: #333;\n        }\n        \n        .problem-card, .similar-problem-card {\n          border: 1px solid #e8e8e8;\n          transition: all 0.2s;\n        }\n        \n        .problem-card:hover, .similar-problem-card:hover {\n          border-color: #1890ff;\n          box-shadow: 0 2px 8px rgba(24, 144, 255, 0.2);\n        }\n        \n        .problem-header, .similar-header {\n          display: flex;\n          justify-content: space-between;\n          align-items: flex-start;\n          margin-bottom: 8px;\n        }\n        \n        .problem-tags, .shared-tags {\n          margin-top: 8px;\n        }\n        \n        .recommendation-info, .learning-path {\n          margin: 4px 0;\n          font-size: 13px;\n        }\n        \n        .feedback-section {\n          margin-top: 16px;\n          padding-top: 12px;\n          border-top: 1px solid #f0f0f0;\n        }\n        \n        @media (max-width: 768px) {\n          .message-content {\n            max-width: 90%;\n          }\n          \n          .response-header {\n            flex-direction: column;\n            align-items: flex-start;\n            gap: 8px;\n          }\n        }\n      `})]});};export default MessageItem;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}