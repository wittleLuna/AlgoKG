{"ast":null,"code":"import React,{useState}from'react';import{Button,Input,Select,Switch,message,Card,Space}from'antd';import{FilterOutlined}from'@ant-design/icons';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{TextArea}=Input;const{Option}=Select;const NoteUpload=_ref=>{let{onUploadSuccess,onCancel}=_ref;const[loading,setLoading]=useState(false);const[uploadMethod,setUploadMethod]=useState('text');// 表单状态\nconst[formData,setFormData]=useState({title:'',description:'',note_type:'algorithm',file_format:'txt',tags:[],is_public:false,extract_entities:true,content:'',file:null});const handleSubmit=async()=>{if(!formData.title.trim()){message.error('请输入笔记标题');return;}if(uploadMethod==='text'&&!formData.content.trim()){message.error('请输入笔记内容');return;}if(uploadMethod==='file'&&!formData.file){message.error('请选择要上传的文件');return;}setLoading(true);try{const submitData=new FormData();// 基本信息\nsubmitData.append('title',formData.title);submitData.append('description',formData.description||'');submitData.append('note_type',formData.note_type);submitData.append('file_format',formData.file_format);submitData.append('tags',JSON.stringify(formData.tags||[]));submitData.append('is_public',formData.is_public?'true':'false');submitData.append('extract_entities',formData.extract_entities?'true':'false');// 内容\nif(uploadMethod==='text'){submitData.append('file_content',formData.content);}else if(formData.file){submitData.append('file',formData.file);}const token=localStorage.getItem('token');const response=await fetch('/api/v1/notes/upload',{method:'POST',headers:{'Authorization':`Bearer ${token}`},body:submitData});if(!response.ok){const errorData=await response.json();throw new Error(errorData.detail||'上传失败');}const result=await response.json();message.success('笔记上传成功！');if(onUploadSuccess){onUploadSuccess(result.id);}// 重置表单\nsetFormData({title:'',description:'',note_type:'algorithm',file_format:'txt',tags:[],is_public:false,extract_entities:true,content:'',file:null});}catch(error){console.error('上传失败:',error);message.error(error.message||'上传失败，请重试');}finally{setLoading(false);}};const noteTypes=[{value:'algorithm',label:'算法笔记'},{value:'data_structure',label:'数据结构笔记'},{value:'problem_solving',label:'题解笔记'},{value:'theory',label:'理论笔记'},{value:'general',label:'通用笔记'}];const fileFormats=[{value:'txt',label:'纯文本'},{value:'md',label:'Markdown'},{value:'pdf',label:'PDF'},{value:'docx',label:'Word文档'}];const handleInputChange=(field,value)=>{console.log('表单字段更新:',field,value);setFormData(prev=>{const newData={...prev,[field]:value};console.log('新的表单数据:',newData);return newData;});};const handleFileChange=event=>{var _event$target$files;const file=((_event$target$files=event.target.files)===null||_event$target$files===void 0?void 0:_event$target$files[0])||null;setFormData(prev=>({...prev,file}));};return/*#__PURE__*/_jsx(Card,{title:\"\\u4E0A\\u4F20\\u7B14\\u8BB0\",style:{maxWidth:800,margin:'0 auto'},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',gap:'16px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'8px',backgroundColor:'#f0f0f0',borderRadius:'4px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'8px',fontSize:'12px',color:'#666'},children:\"\\uD83D\\uDD27 \\u6D4B\\u8BD5Select\\u7EC4\\u4EF6\\uFF08\\u5982\\u679C\\u8FD9\\u4E2A\\u80FD\\u6B63\\u5E38\\u5DE5\\u4F5C\\uFF0C\\u8BF4\\u660E\\u5176\\u4ED6Select\\u4E5F\\u5E94\\u8BE5\\u80FD\\u5DE5\\u4F5C\\uFF09:\"}),/*#__PURE__*/_jsxs(Select,{placeholder:\"\\u6D4B\\u8BD5\\u9009\\u62E9\\u6846\",style:{width:200},onChange:value=>console.log('测试选择:',value),getPopupContainer:trigger=>trigger.parentElement||document.body,dropdownStyle:{zIndex:9999},children:[/*#__PURE__*/_jsx(Option,{value:\"test1\",children:\"\\u6D4B\\u8BD5\\u9009\\u98791\"}),/*#__PURE__*/_jsx(Option,{value:\"test2\",children:\"\\u6D4B\\u8BD5\\u9009\\u98792\"}),/*#__PURE__*/_jsx(Option,{value:\"test3\",children:\"\\u6D4B\\u8BD5\\u9009\\u98793\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u7B14\\u8BB0\\u6807\\u9898 *\"}),/*#__PURE__*/_jsx(Input,{placeholder:\"\\u8BF7\\u8F93\\u5165\\u7B14\\u8BB0\\u6807\\u9898\",value:formData.title,onChange:e=>handleInputChange('title',e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u7B14\\u8BB0\\u63CF\\u8FF0\"}),/*#__PURE__*/_jsx(Input.TextArea,{rows:2,placeholder:\"\\u8BF7\\u8F93\\u5165\\u7B14\\u8BB0\\u63CF\\u8FF0\\uFF08\\u53EF\\u9009\\uFF09\",value:formData.description,onChange:e=>handleInputChange('description',e.target.value)})]}),/*#__PURE__*/_jsxs(Space,{size:\"large\",style:{width:'100%'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:150},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u7B14\\u8BB0\\u7C7B\\u578B\"}),/*#__PURE__*/_jsx(Select,{value:formData.note_type,onChange:value=>handleInputChange('note_type',value),style:{width:'100%'},placeholder:\"\\u9009\\u62E9\\u7B14\\u8BB0\\u7C7B\\u578B\",getPopupContainer:trigger=>trigger.parentElement||document.body,dropdownStyle:{zIndex:9999},children:noteTypes.map(type=>/*#__PURE__*/_jsx(Option,{value:type.value,children:type.label},type.value))},\"note_type\")]}),/*#__PURE__*/_jsxs(\"div\",{style:{minWidth:120},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u6587\\u4EF6\\u683C\\u5F0F\"}),/*#__PURE__*/_jsx(Select,{value:formData.file_format,onChange:value=>handleInputChange('file_format',value),style:{width:'100%'},placeholder:\"\\u9009\\u62E9\\u6587\\u4EF6\\u683C\\u5F0F\",getPopupContainer:trigger=>trigger.parentElement||document.body,dropdownStyle:{zIndex:9999},children:fileFormats.map(format=>/*#__PURE__*/_jsx(Option,{value:format.value,children:format.label},format.value))},\"file_format\")]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u6807\\u7B7E\"}),/*#__PURE__*/_jsx(Select,{mode:\"tags\",placeholder:\"\\u8F93\\u5165\\u6807\\u7B7E\\uFF0C\\u6309\\u56DE\\u8F66\\u6DFB\\u52A0\",style:{width:'100%'},value:formData.tags,onChange:value=>handleInputChange('tags',value),getPopupContainer:trigger=>trigger.parentElement||document.body,dropdownStyle:{zIndex:9999}},\"tags\")]}),/*#__PURE__*/_jsxs(Space,{size:\"large\",style:{width:'100%'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u516C\\u5F00\\u7B14\\u8BB0\"}),/*#__PURE__*/_jsx(Switch,{checked:formData.is_public,onChange:checked=>handleInputChange('is_public',checked)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u62BD\\u53D6\\u5B9E\\u4F53\"}),/*#__PURE__*/_jsx(Switch,{checked:formData.extract_entities,onChange:checked=>handleInputChange('extract_entities',checked)})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u4E0A\\u4F20\\u65B9\\u5F0F\"}),/*#__PURE__*/_jsxs(Select,{value:uploadMethod,onChange:setUploadMethod,style:{width:200},getPopupContainer:trigger=>trigger.parentElement||document.body,dropdownStyle:{zIndex:9999},children:[/*#__PURE__*/_jsx(Option,{value:\"text\",children:\"\\u76F4\\u63A5\\u8F93\\u5165\\u6587\\u672C\"}),/*#__PURE__*/_jsx(Option,{value:\"file\",children:\"\\u4E0A\\u4F20\\u6587\\u4EF6\"})]})]}),uploadMethod==='text'?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u7B14\\u8BB0\\u5185\\u5BB9 *\"}),/*#__PURE__*/_jsx(Input.TextArea,{rows:12,placeholder:\"\\u8BF7\\u8F93\\u5165\\u7B14\\u8BB0\\u5185\\u5BB9...\",style:{fontFamily:'monospace'},value:formData.content,onChange:e=>handleInputChange('content',e.target.value)})]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u9009\\u62E9\\u6587\\u4EF6 *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".txt,.md,.pdf,.docx,.doc\",onChange:handleFileChange,style:{width:'100%',padding:'8px',border:'1px solid #d9d9d9',borderRadius:'6px'}}),formData.file&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'8px',color:'#666'},children:[\"\\u5DF2\\u9009\\u62E9\\u6587\\u4EF6: \",formData.file.name]})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:24},children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>{setFormData({title:'',description:'',note_type:'algorithm',file_format:'txt',tags:[],is_public:false,extract_entities:true,content:'',file:null});console.log('表单已重置');},children:\"\\u91CD\\u7F6E\\u8868\\u5355\"}),/*#__PURE__*/_jsx(Button,{type:\"primary\",loading:loading,icon:/*#__PURE__*/_jsx(FilterOutlined,{}),onClick:handleSubmit,children:\"\\u4E0A\\u4F20\\u7B14\\u8BB0\"}),onCancel&&/*#__PURE__*/_jsx(Button,{onClick:onCancel,children:\"\\u53D6\\u6D88\"})]})})]})});};export default NoteUpload;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}