{"ast":null,"code":"import React,{useState}from'react';import{Card,Button,Input,Space,message}from'antd';import{UserOutlined,LikeOutlined}from'@ant-design/icons';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Login=_ref=>{let{onLoginSuccess}=_ref;const[loading,setLoading]=useState(false);const[formData,setFormData]=useState({username:'',password:''});const handleInputChange=(field,value)=>{setFormData(prev=>({...prev,[field]:value}));};const handleLogin=async()=>{if(!formData.username.trim()||!formData.password.trim()){message.error('请输入用户名和密码');return;}setLoading(true);try{const response=await fetch('/api/v1/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({username:formData.username,password:formData.password})});if(!response.ok){const errorData=await response.json();throw new Error(errorData.detail||'登录失败');}const data=await response.json();// 保存令牌\nlocalStorage.setItem('token',data.access_token);localStorage.setItem('user',JSON.stringify(data.user));message.success('登录成功！');if(onLoginSuccess){onLoginSuccess(data.access_token,data.user);}}catch(error){console.error('登录失败:',error);message.error(error.message||'登录失败，请重试');}finally{setLoading(false);}};const handleTestLogin=async()=>{setLoading(true);try{const response=await fetch('/api/v1/auth/test-login',{method:'POST',headers:{'Content-Type':'application/json'}});if(!response.ok){const errorData=await response.json();throw new Error(errorData.detail||'测试登录失败');}const data=await response.json();console.log('测试登录响应数据:',data);// 调试日志\n// 保存令牌\nlocalStorage.setItem('token',data.access_token);localStorage.setItem('user',JSON.stringify(data.user));console.log('已保存令牌和用户数据到 localStorage');// 调试日志\nconsole.log('令牌:',data.access_token);console.log('用户:',data.user);message.success('测试登录成功！');if(onLoginSuccess){onLoginSuccess(data.access_token,data.user);}}catch(error){console.error('测试登录失败:',error);message.error(error.message||'测试登录失败，请重试');}finally{setLoading(false);}};const handleKeyPress=e=>{if(e.key==='Enter'){handleLogin();}};return/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',minHeight:'60vh',padding:'20px'},children:/*#__PURE__*/_jsx(Card,{title:\"\\u7528\\u6237\\u767B\\u5F55\",style:{width:400},children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',gap:'16px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u7528\\u6237\\u540D\"}),/*#__PURE__*/_jsx(Input,{prefix:/*#__PURE__*/_jsx(UserOutlined,{}),placeholder:\"\\u8BF7\\u8F93\\u5165\\u7528\\u6237\\u540D\",value:formData.username,onChange:e=>handleInputChange('username',e.target.value),onKeyPress:handleKeyPress})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'4px',fontWeight:'bold'},children:\"\\u5BC6\\u7801\"}),/*#__PURE__*/_jsx(Input,{type:\"password\",prefix:/*#__PURE__*/_jsx(LikeOutlined,{}),placeholder:\"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\",value:formData.password,onChange:e=>handleInputChange('password',e.target.value),onKeyPress:handleKeyPress})]}),/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",style:{width:'100%'},children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",loading:loading,onClick:handleLogin,style:{width:'100%'},children:\"\\u767B\\u5F55\"}),/*#__PURE__*/_jsx(Button,{type:\"default\",loading:loading,onClick:handleTestLogin,style:{width:'100%'},children:\"\\u6D4B\\u8BD5\\u767B\\u5F55\\uFF08\\u5F00\\u53D1\\u7528\\uFF09\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{textAlign:'center',fontSize:'12px',color:'#999'},children:[/*#__PURE__*/_jsx(\"div\",{children:\"\\u6D4B\\u8BD5\\u8D26\\u53F7\\uFF1A\\u4EFB\\u610F\\u7528\\u6237\\u540D\\u548C\\u5BC6\\u7801\"}),/*#__PURE__*/_jsx(\"div\",{children:\"\\u6216\\u76F4\\u63A5\\u70B9\\u51FB\\\"\\u6D4B\\u8BD5\\u767B\\u5F55\\\"\"})]})]})})});};export default Login;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}