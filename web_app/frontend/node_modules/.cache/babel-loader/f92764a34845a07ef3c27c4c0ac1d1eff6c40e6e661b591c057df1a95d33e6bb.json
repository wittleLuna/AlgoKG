{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Card,List,Button,Space,Typography,Empty,Tooltip,Input}from'antd';import{UserOutlined,LeftOutlined,ClockCircleOutlined}from'@ant-design/icons';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Text}=Typography;const{Search}=Input;const SearchHistory=_ref=>{let{onSelectHistory,visible,onClose}=_ref;const[history,setHistory]=useState([]);const[filteredHistory,setFilteredHistory]=useState([]);const[searchTerm,setSearchTerm]=useState('');// 加载搜索历史\nuseEffect(()=>{const savedHistory=localStorage.getItem('search_history');if(savedHistory){try{const parsed=JSON.parse(savedHistory);setHistory(parsed);setFilteredHistory(parsed);}catch(error){console.error('Failed to parse search history:',error);}}},[visible]);// 过滤搜索历史\nuseEffect(()=>{if(searchTerm.trim()){const filtered=history.filter(item=>item.query.toLowerCase().includes(searchTerm.toLowerCase()));setFilteredHistory(filtered);}else{setFilteredHistory(history);}},[searchTerm,history]);// 添加搜索历史\nconst addToHistory=query=>{const newItem={id:Date.now().toString(),query:query.trim(),timestamp:Date.now(),category:'general'};const updatedHistory=[newItem,...history.filter(item=>item.query!==query.trim())].slice(0,50);setHistory(updatedHistory);localStorage.setItem('search_history',JSON.stringify(updatedHistory));};// 删除单个历史记录\nconst deleteHistoryItem=id=>{const updatedHistory=history.filter(item=>item.id!==id);setHistory(updatedHistory);setFilteredHistory(updatedHistory);localStorage.setItem('search_history',JSON.stringify(updatedHistory));};// 清空所有历史记录\nconst clearAllHistory=()=>{setHistory([]);setFilteredHistory([]);localStorage.removeItem('search_history');};// 选择历史记录\nconst handleSelectHistory=query=>{onSelectHistory(query);addToHistory(query);// 重新添加到顶部\nonClose();};// 格式化时间\nconst formatTime=timestamp=>{const now=Date.now();const diff=now-timestamp;const minutes=Math.floor(diff/(1000*60));const hours=Math.floor(diff/(1000*60*60));const days=Math.floor(diff/(1000*60*60*24));if(minutes<1)return'刚刚';if(minutes<60)return`${minutes}分钟前`;if(hours<24)return`${hours}小时前`;if(days<7)return`${days}天前`;return new Date(timestamp).toLocaleDateString();};if(!visible)return null;return/*#__PURE__*/_jsxs(Card,{title:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(UserOutlined,{}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u641C\\u7D22\\u5386\\u53F2\"}),/*#__PURE__*/_jsxs(Text,{type:\"secondary\",children:[\"(\",filteredHistory.length,\")\"]})]}),extra:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"text\",size:\"small\",onClick:clearAllHistory,disabled:history.length===0,children:\"\\u6E05\\u7A7A\"}),/*#__PURE__*/_jsx(Button,{type:\"text\",size:\"small\",onClick:onClose,children:\"\\u5173\\u95ED\"})]}),style:{position:'absolute',top:'100%',left:0,right:0,zIndex:1000,marginTop:8,maxHeight:400,overflow:'hidden',boxShadow:'0 4px 12px rgba(0, 0, 0, 0.15)'},children:[history.length>0&&/*#__PURE__*/_jsx(Search,{placeholder:\"\\u641C\\u7D22\\u5386\\u53F2\\u8BB0\\u5F55...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value),style:{marginBottom:16},allowClear:true}),filteredHistory.length===0?/*#__PURE__*/_jsx(Empty,{image:null,description:history.length===0?\"暂无搜索历史\":\"未找到匹配的历史记录\",style:{padding:'20px 0'}}):/*#__PURE__*/_jsx(List,{size:\"small\",dataSource:filteredHistory,style:{maxHeight:250,overflow:'auto'},renderItem:item=>/*#__PURE__*/_jsx(List.Item,{style:{padding:'8px 0',cursor:'pointer',borderRadius:4,margin:'2px 0'},onMouseEnter:e=>{e.currentTarget.style.background='#f5f5f5';},onMouseLeave:e=>{e.currentTarget.style.background='transparent';},onClick:()=>handleSelectHistory(item.query),actions:[/*#__PURE__*/_jsx(Tooltip,{title:\"\\u5220\\u9664\",children:/*#__PURE__*/_jsx(Button,{type:\"text\",size:\"small\",icon:/*#__PURE__*/_jsx(LeftOutlined,{}),onClick:e=>{e.stopPropagation();deleteHistoryItem(item.id);},style:{color:'#999'}})})],children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',width:'100%'},children:[/*#__PURE__*/_jsx(ClockCircleOutlined,{style:{color:'#999',marginRight:12}}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(Text,{ellipsis:true,style:{fontSize:14},children:item.query}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Text,{type:\"secondary\",style:{fontSize:12},children:formatTime(item.timestamp)})})]})]})})})]});};// 导出添加历史记录的工具函数\nexport const addSearchHistory=query=>{const savedHistory=localStorage.getItem('search_history');let history=[];if(savedHistory){try{history=JSON.parse(savedHistory);}catch(error){console.error('Failed to parse search history:',error);}}const newItem={id:Date.now().toString(),query:query.trim(),timestamp:Date.now(),category:'general'};const updatedHistory=[newItem,...history.filter(item=>item.query!==query.trim())].slice(0,50);localStorage.setItem('search_history',JSON.stringify(updatedHistory));};export default SearchHistory;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}