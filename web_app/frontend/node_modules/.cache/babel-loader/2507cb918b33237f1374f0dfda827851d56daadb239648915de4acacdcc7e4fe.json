{"ast":null,"code":"import React,{useState,useEffect}from'react';import{createPortal}from'react-dom';import{List,Button,Empty,message,Tabs,Space,Typography,Tag,Input}from'antd';import{SearchOutlined,QuestionCircleOutlined,NodeIndexOutlined,CloseOutlined,UserOutlined}from'@ant-design/icons';import{authService}from'../../services/authService';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Title,Text}=Typography;const{Search}=Input;const SearchHistoryPanel=_ref=>{let{visible,onClose,onSearchClick}=_ref;const[searchHistory,setSearchHistory]=useState([]);const[loading,setLoading]=useState(false);const[activeTab,setActiveTab]=useState('all');const[searchQuery,setSearchQuery]=useState('');useEffect(()=>{if(visible){loadSearchHistory();}},[visible,activeTab]);const loadSearchHistory=async()=>{setLoading(true);try{const searchType=activeTab==='all'?undefined:activeTab;const data=await authService.getSearchHistory(searchType);setSearchHistory(data);}catch(error){message.error(error.message||'加载搜索历史失败');}finally{setLoading(false);}};const handleClearHistory=async searchType=>{try{await authService.clearSearchHistory(searchType);message.success('搜索历史已清空');loadSearchHistory();}catch(error){message.error(error.message||'清空搜索历史失败');}};const handleSearchClick=history=>{if(onSearchClick){onSearchClick(history.query,history.search_type);}};const getSearchTypeIcon=type=>{switch(type){case'qa':return/*#__PURE__*/_jsx(QuestionCircleOutlined,{style:{color:'#1890ff'}});case'graph':return/*#__PURE__*/_jsx(NodeIndexOutlined,{style:{color:'#52c41a'}});case'problem':return/*#__PURE__*/_jsx(SearchOutlined,{style:{color:'#faad14'}});default:return/*#__PURE__*/_jsx(SearchOutlined,{style:{color:'#666'}});}};const getSearchTypeLabel=type=>{switch(type){case'qa':return'问答';case'graph':return'图谱';case'problem':return'题目';default:return'其他';}};const getSearchTypeColor=type=>{switch(type){case'qa':return'blue';case'graph':return'green';case'problem':return'orange';default:return'default';}};const filteredHistory=searchHistory.filter(history=>{if(!searchQuery)return true;const query=searchQuery.toLowerCase();return history.query.toLowerCase().includes(query);});const renderHistoryItem=history=>/*#__PURE__*/_jsx(List.Item,{actions:[/*#__PURE__*/_jsx(Button,{type:\"text\",size:\"small\",onClick:()=>handleSearchClick(history),title:\"\\u91CD\\u65B0\\u641C\\u7D22\",children:\"\\u641C\\u7D22\"})],style:{cursor:'pointer'},onClick:()=>handleSearchClick(history),children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'flex-start',gap:'12px',width:'100%'},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'4px'},children:getSearchTypeIcon(history.search_type)}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'8px'},children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:'bold'},children:history.query}),/*#__PURE__*/_jsx(Tag,{color:getSearchTypeColor(history.search_type),size:\"small\",children:getSearchTypeLabel(history.search_type)}),history.results_count>0&&/*#__PURE__*/_jsx(\"span\",{style:{backgroundColor:'#52c41a',color:'white',padding:'2px 6px',borderRadius:'10px',fontSize:'12px'},children:history.results_count})]})}),/*#__PURE__*/_jsxs(Text,{type:\"secondary\",style:{fontSize:'12px'},children:[\"\\u641C\\u7D22\\u65F6\\u95F4: \",new Date(history.created_at).toLocaleString('zh-CN')]})]})]})},history.id);const getTabExtra=searchType=>/*#__PURE__*/_jsx(Button,{type:\"text\",size:\"small\",danger:true,onClick:()=>{if(window.confirm(`确定要清空${searchType?getSearchTypeLabel(searchType):'全部'}搜索历史吗？`)){handleClearHistory(searchType);}},children:\"\\u6E05\\u7A7A\"});const tabItems=[{key:'all',label:`全部 (${searchHistory.length})`,children:/*#__PURE__*/_jsx(List,{dataSource:filteredHistory,renderItem:renderHistoryItem,loading:loading,locale:{emptyText:/*#__PURE__*/_jsx(Empty,{description:\"\\u6682\\u65E0\\u641C\\u7D22\\u5386\\u53F2\"})}})},{key:'qa',label:`问答 (${searchHistory.filter(h=>h.search_type==='qa').length})`,children:/*#__PURE__*/_jsx(List,{dataSource:filteredHistory.filter(h=>h.search_type==='qa'),renderItem:renderHistoryItem,loading:loading,locale:{emptyText:/*#__PURE__*/_jsx(Empty,{description:\"\\u6682\\u65E0\\u95EE\\u7B54\\u641C\\u7D22\\u5386\\u53F2\"})}})},{key:'graph',label:`图谱 (${searchHistory.filter(h=>h.search_type==='graph').length})`,children:/*#__PURE__*/_jsx(List,{dataSource:filteredHistory.filter(h=>h.search_type==='graph'),renderItem:renderHistoryItem,loading:loading,locale:{emptyText:/*#__PURE__*/_jsx(Empty,{description:\"\\u6682\\u65E0\\u56FE\\u8C31\\u641C\\u7D22\\u5386\\u53F2\"})}})},{key:'problem',label:`题目 (${searchHistory.filter(h=>h.search_type==='problem').length})`,children:/*#__PURE__*/_jsx(List,{dataSource:filteredHistory.filter(h=>h.search_type==='problem'),renderItem:renderHistoryItem,loading:loading,locale:{emptyText:/*#__PURE__*/_jsx(Empty,{description:\"\\u6682\\u65E0\\u9898\\u76EE\\u641C\\u7D22\\u5386\\u53F2\"})}})}];console.log('SearchHistoryPanel render:',visible);if(!visible)return null;const panelContent=/*#__PURE__*/_jsxs(\"div\",{style:{position:'fixed',top:0,right:0,width:'480px',height:'100vh',backgroundColor:'white',boxShadow:'-2px 0 8px rgba(0, 0, 0, 0.15)',zIndex:9999,display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'16px 24px',borderBottom:'1px solid #f0f0f0',display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#1890ff'}}),\"\\u641C\\u7D22\\u5386\\u53F2\"]}),/*#__PURE__*/_jsxs(Space,{children:[getTabExtra(activeTab==='all'?undefined:activeTab),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(CloseOutlined,{}),onClick:onClose})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,padding:'16px 24px',overflow:'auto'},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:16},children:/*#__PURE__*/_jsx(Search,{placeholder:\"\\u641C\\u7D22\\u5386\\u53F2\\u8BB0\\u5F55...\",allowClear:true,value:searchQuery,onChange:e=>setSearchQuery(e.target.value),style:{width:'100%'}})}),/*#__PURE__*/_jsx(Tabs,{activeKey:activeTab,onChange:setActiveTab,items:tabItems,size:\"small\"})]})]});return/*#__PURE__*/createPortal(panelContent,document.body);};export default SearchHistoryPanel;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}