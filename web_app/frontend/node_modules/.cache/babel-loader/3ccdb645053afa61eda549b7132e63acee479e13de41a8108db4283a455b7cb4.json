{"ast":null,"code":"import React,{useState,useEffect}from'react';import{createPortal}from'react-dom';import ReactMarkdown from'react-markdown';import{Prism as SyntaxHighlighter}from'react-syntax-highlighter';import{tomorrow}from'react-syntax-highlighter/dist/esm/styles/prism';import{List,Button,Empty,message,Tabs,Space,Typography,Tag,Input}from'antd';import{QuestionCircleOutlined,NodeIndexOutlined,MessageOutlined,CloseOutlined,UserOutlined,CopyOutlined}from'@ant-design/icons';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const{Title,Text,Paragraph}=Typography;const{Search}=Input;const FavoritesPanel=_ref=>{let{visible,onClose}=_ref;const[favorites,setFavorites]=useState([]);const[loading,setLoading]=useState(false);const[activeTab,setActiveTab]=useState('all');const[searchQuery,setSearchQuery]=useState('');const[selectedFavorite,setSelectedFavorite]=useState(null);const handleCopy=text=>{navigator.clipboard.writeText(text);message.success('已复制到剪贴板');};// Markdown渲染组件\nconst MarkdownRenderer=_ref2=>{let{content}=_ref2;return/*#__PURE__*/_jsx(ReactMarkdown,{components:{code(_ref3){let{node,inline,className,children,...props}=_ref3;const match=/language-(\\w+)/.exec(className||'');return!inline&&match?/*#__PURE__*/_jsx(SyntaxHighlighter,{style:tomorrow,language:match[1],PreTag:\"div\",...props,children:String(children).replace(/\\n$/,'')}):/*#__PURE__*/_jsx(\"code\",{className:className,...props,style:{backgroundColor:'#f5f5f5',padding:'2px 4px',borderRadius:'3px',fontSize:'0.9em'},children:children});},h1:_ref4=>{let{children}=_ref4;return/*#__PURE__*/_jsx(\"h1\",{style:{fontSize:'1.5em',fontWeight:'bold',marginBottom:'0.5em',borderBottom:'2px solid #eee',paddingBottom:'0.3em'},children:children});},h2:_ref5=>{let{children}=_ref5;return/*#__PURE__*/_jsx(\"h2\",{style:{fontSize:'1.3em',fontWeight:'bold',marginBottom:'0.5em',borderBottom:'1px solid #eee',paddingBottom:'0.2em'},children:children});},h3:_ref6=>{let{children}=_ref6;return/*#__PURE__*/_jsx(\"h3\",{style:{fontSize:'1.2em',fontWeight:'bold',marginBottom:'0.5em'},children:children});},p:_ref7=>{let{children}=_ref7;return/*#__PURE__*/_jsx(\"p\",{style:{marginBottom:'1em',lineHeight:'1.6'},children:children});},ul:_ref8=>{let{children}=_ref8;return/*#__PURE__*/_jsx(\"ul\",{style:{marginBottom:'1em',paddingLeft:'1.5em'},children:children});},ol:_ref9=>{let{children}=_ref9;return/*#__PURE__*/_jsx(\"ol\",{style:{marginBottom:'1em',paddingLeft:'1.5em'},children:children});},li:_ref0=>{let{children}=_ref0;return/*#__PURE__*/_jsx(\"li\",{style:{marginBottom:'0.3em'},children:children});},blockquote:_ref1=>{let{children}=_ref1;return/*#__PURE__*/_jsx(\"blockquote\",{style:{borderLeft:'4px solid #ddd',paddingLeft:'1em',margin:'1em 0',fontStyle:'italic',backgroundColor:'#f9f9f9',padding:'0.5em 1em'},children:children});},strong:_ref10=>{let{children}=_ref10;return/*#__PURE__*/_jsx(\"strong\",{style:{fontWeight:'bold'},children:children});},em:_ref11=>{let{children}=_ref11;return/*#__PURE__*/_jsx(\"em\",{style:{fontStyle:'italic'},children:children});}},children:content});};useEffect(()=>{if(visible){loadFavorites();}},[visible,activeTab]);const loadFavorites=async()=>{setLoading(true);try{// 暂时使用localStorage，后续可以改为API调用\nconst saved=localStorage.getItem('favorites');if(saved){const parsed=JSON.parse(saved);console.log('加载的收藏数据:',parsed);const filtered=activeTab==='all'?parsed:parsed.filter(item=>item.type===activeTab);setFavorites(filtered);}else{setFavorites([]);}}catch(error){console.error('加载收藏失败:',error);setFavorites([]);}finally{setLoading(false);}};const handleRemoveFavorite=async favorite=>{try{// 暂时使用localStorage\nconst saved=localStorage.getItem('favorites');if(saved){const favorites=JSON.parse(saved);const newFavorites=favorites.filter(item=>item.id!==favorite.id);localStorage.setItem('favorites',JSON.stringify(newFavorites));message.success('已移除收藏');loadFavorites();}}catch(error){message.error('移除收藏失败');}};const getItemTypeIcon=type=>{switch(type){case'query':return/*#__PURE__*/_jsx(QuestionCircleOutlined,{style:{color:'#1890ff'}});case'response':return/*#__PURE__*/_jsx(MessageOutlined,{style:{color:'#52c41a'}});case'concept':return/*#__PURE__*/_jsx(NodeIndexOutlined,{style:{color:'#722ed1'}});case'problem':return/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#fa8c16'}});default:return/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#f5222d'}});}};const getItemTypeLabel=type=>{switch(type){case'query':return'问题';case'response':return'回答';case'concept':return'概念';case'problem':return'问题';default:return'其他';}};const getItemTypeColor=type=>{switch(type){case'query':return'blue';case'response':return'green';case'concept':return'purple';case'problem':return'orange';default:return'default';}};const filteredFavorites=favorites.filter(favorite=>{var _favorite$title,_favorite$content,_favorite$id;if(!searchQuery)return true;const query=searchQuery.toLowerCase();return((_favorite$title=favorite.title)===null||_favorite$title===void 0?void 0:_favorite$title.toLowerCase().includes(query))||((_favorite$content=favorite.content)===null||_favorite$content===void 0?void 0:_favorite$content.toLowerCase().includes(query))||((_favorite$id=favorite.id)===null||_favorite$id===void 0?void 0:_favorite$id.toLowerCase().includes(query));});const renderFavoriteItem=favorite=>/*#__PURE__*/_jsx(List.Item,{actions:[/*#__PURE__*/_jsx(Button,{type:\"text\",onClick:e=>{e.stopPropagation();setSelectedFavorite(favorite);},size:\"small\",title:\"\\u67E5\\u770B\\u8BE6\\u60C5\",children:\"\\u67E5\\u770B\"}),/*#__PURE__*/_jsx(Button,{type:\"text\",onClick:e=>{e.stopPropagation();handleRemoveFavorite(favorite);},danger:true,size:\"small\",title:\"\\u79FB\\u9664\\u6536\\u85CF\",children:\"\\u5220\\u9664\"})],style:{cursor:'pointer'},onClick:()=>setSelectedFavorite(favorite),children:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'flex-start',gap:'12px',width:'100%'},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'4px'},children:getItemTypeIcon(favorite.type)}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'8px'},children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:'bold'},children:favorite.title||favorite.id}),/*#__PURE__*/_jsx(Tag,{color:getItemTypeColor(favorite.type),size:\"small\",children:getItemTypeLabel(favorite.type)})]})}),favorite.content&&/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'8px',color:'#666',lineHeight:'1.5'},children:favorite.content.length>200?`${favorite.content.substring(0,200)}...`:favorite.content}),/*#__PURE__*/_jsxs(Text,{type:\"secondary\",style:{fontSize:'12px'},children:[\"\\u6536\\u85CF\\u65F6\\u95F4: \",new Date(favorite.timestamp).toLocaleString('zh-CN')]})]})]})},favorite.id);const tabItems=[{key:'all',label:`全部 (${favorites.length})`,children:/*#__PURE__*/_jsx(List,{dataSource:filteredFavorites,renderItem:renderFavoriteItem,loading:loading,locale:{emptyText:/*#__PURE__*/_jsx(Empty,{description:\"\\u6682\\u65E0\\u6536\\u85CF\"})}})},{key:'query',label:`问题 (${favorites.filter(f=>f.type==='query').length})`,children:/*#__PURE__*/_jsx(List,{dataSource:filteredFavorites.filter(f=>f.type==='query'),renderItem:renderFavoriteItem,loading:loading,locale:{emptyText:/*#__PURE__*/_jsx(Empty,{description:\"\\u6682\\u65E0\\u95EE\\u9898\\u6536\\u85CF\"})}})},{key:'response',label:`回答 (${favorites.filter(f=>f.type==='response').length})`,children:/*#__PURE__*/_jsx(List,{dataSource:filteredFavorites.filter(f=>f.type==='response'),renderItem:renderFavoriteItem,loading:loading,locale:{emptyText:/*#__PURE__*/_jsx(Empty,{description:\"\\u6682\\u65E0\\u56DE\\u7B54\\u6536\\u85CF\"})}})},{key:'concept',label:`概念 (${favorites.filter(f=>f.type==='concept').length})`,children:/*#__PURE__*/_jsx(List,{dataSource:filteredFavorites.filter(f=>f.type==='concept'),renderItem:renderFavoriteItem,loading:loading,locale:{emptyText:/*#__PURE__*/_jsx(Empty,{description:\"\\u6682\\u65E0\\u6982\\u5FF5\\u6536\\u85CF\"})}})}];if(!visible)return null;const panelContent=/*#__PURE__*/_jsxs(\"div\",{style:{position:'fixed',top:0,right:0,width:'480px',height:'100vh',backgroundColor:'white',boxShadow:'-2px 0 8px rgba(0, 0, 0, 0.15)',zIndex:9999,display:'flex',flexDirection:'column'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{padding:'16px 24px',borderBottom:'1px solid #f0f0f0',display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(UserOutlined,{style:{color:'#f5222d'}}),\"\\u6211\\u7684\\u6536\\u85CF\"]}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(CloseOutlined,{}),onClick:onClose})]}),/*#__PURE__*/_jsxs(\"div\",{style:{flex:1,padding:'16px 24px',overflow:'auto'},children:[/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:16},children:/*#__PURE__*/_jsx(Search,{placeholder:\"\\u641C\\u7D22\\u6536\\u85CF\\u5185\\u5BB9...\",allowClear:true,value:searchQuery,onChange:e=>setSearchQuery(e.target.value),style:{width:'100%'}})}),/*#__PURE__*/_jsx(Tabs,{activeKey:activeTab,onChange:setActiveTab,items:tabItems,size:\"small\"})]}),selectedFavorite&&/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',top:0,left:0,right:0,bottom:0,backgroundColor:'rgba(0, 0, 0, 0.5)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:10000},onClick:()=>setSelectedFavorite(null),children:/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:'white',borderRadius:'8px',maxWidth:'80%',maxHeight:'80%',overflow:'auto',padding:'24px'},onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px',display:'flex',justifyContent:'space-between',alignItems:'center'},children:[/*#__PURE__*/_jsxs(Space,{children:[getItemTypeIcon(selectedFavorite.type),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:'18px',fontWeight:'bold'},children:selectedFavorite.title}),/*#__PURE__*/_jsx(Tag,{color:getItemTypeColor(selectedFavorite.type),children:getItemTypeLabel(selectedFavorite.type)})]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(CopyOutlined,{}),onClick:()=>handleCopy(selectedFavorite.content),title:\"\\u590D\\u5236\\u5185\\u5BB9\",children:\"\\u590D\\u5236\"}),/*#__PURE__*/_jsx(Button,{type:\"text\",icon:/*#__PURE__*/_jsx(CloseOutlined,{}),onClick:()=>setSelectedFavorite(null)})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'16px',maxHeight:'60vh',overflow:'auto'},children:/*#__PURE__*/_jsx(MarkdownRenderer,{content:selectedFavorite.content})}),/*#__PURE__*/_jsx(\"div\",{style:{borderTop:'1px solid #f0f0f0',paddingTop:'16px'},children:/*#__PURE__*/_jsxs(Text,{type:\"secondary\",style:{fontSize:'12px'},children:[\"\\u6536\\u85CF\\u65F6\\u95F4: \",new Date(selectedFavorite.timestamp).toLocaleString('zh-CN')]})})]})})]});return/*#__PURE__*/createPortal(panelContent,document.body);};export default FavoritesPanel;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}