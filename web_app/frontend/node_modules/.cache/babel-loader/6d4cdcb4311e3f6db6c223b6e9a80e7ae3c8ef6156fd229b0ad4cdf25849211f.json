{"ast":null,"code":"import React,{useState,useEffect}from'react';import{Card,Button,Space,message,Spin,Divider,Tag}from'antd';import{LeftOutlined,NodeIndexOutlined,FilterOutlined}from'@ant-design/icons';import EntityDetailPanel from'./EntityDetailPanel';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const NoteDetail=_ref=>{let{note,onBack,onEntityVisualize}=_ref;const[entityData,setEntityData]=useState(null);const[loading,setLoading]=useState(false);const[extracting,setExtracting]=useState(false);const fetchEntityData=async()=>{if(!note.entities_extracted)return;setLoading(true);try{const token=localStorage.getItem('token');const response=await fetch(`/api/v1/notes/${note.id}/entities`,{headers:{'Authorization':`Bearer ${token}`}});if(!response.ok){throw new Error('获取实体数据失败');}const data=await response.json();setEntityData(data);}catch(error){console.error('获取实体数据失败:',error);message.error(error.message||'获取实体数据失败');}finally{setLoading(false);}};useEffect(()=>{fetchEntityData();},[note.id]);const handleReExtractEntities=async()=>{setExtracting(true);try{const token=localStorage.getItem('token');console.log('开始重新抽取实体，笔记ID:',note.id);const response=await fetch(`/api/v1/notes/${note.id}/extract-entities`,{method:'POST',headers:{'Authorization':`Bearer ${token}`}});if(!response.ok){const errorData=await response.json();throw new Error(errorData.detail||'重新抽取实体失败');}const result=await response.json();console.log('重新抽取实体结果:',result);message.success(`实体重新抽取成功！提取了 ${result.entity_count} 个实体，${result.relation_count} 个关系`);// 重新获取实体数据\nawait fetchEntityData();}catch(error){console.error('重新抽取实体失败:',error);message.error(error.message||'重新抽取实体失败');}finally{setExtracting(false);}};const formatDate=dateString=>{return new Date(dateString).toLocaleString('zh-CN');};const getTypeLabel=type=>{const typeMap={'algorithm':'算法','data_structure':'数据结构','problem_solving':'题解','theory':'理论','general':'通用'};return typeMap[type]||type;};const getEntityTypeColor=type=>{const colorMap={'algorithm_paradigm':'blue','data_structure':'green','technique':'orange','problem_type':'purple','complexity':'red','default':'default'};return colorMap[type]||colorMap.default;};const getEntityTypeLabel=type=>{const labelMap={'algorithm_paradigm':'算法范式','data_structure':'数据结构','technique':'算法技巧','problem_type':'问题类型','complexity':'复杂度'};return labelMap[type]||type;};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(Button,{icon:/*#__PURE__*/_jsx(LeftOutlined,{}),onClick:onBack,style:{marginBottom:'16px'},children:\"\\u8FD4\\u56DE\\u5217\\u8868\"}),/*#__PURE__*/_jsxs(Card,{title:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(FilterOutlined,{}),/*#__PURE__*/_jsx(\"span\",{children:note.title}),/*#__PURE__*/_jsx(Tag,{color:\"blue\",children:getTypeLabel(note.note_type)})]}),children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u63CF\\u8FF0\\uFF1A\"}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'4px',color:'#666'},children:note.description||'无描述'})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u6807\\u7B7E\\uFF1A\"}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'4px'},children:/*#__PURE__*/_jsxs(Space,{wrap:true,children:[note.tags.map((tag,index)=>/*#__PURE__*/_jsx(Tag,{color:\"cyan\",children:tag},index)),note.tags.length===0&&/*#__PURE__*/_jsx(\"span\",{style:{color:'#999'},children:\"\\u65E0\\u6807\\u7B7E\"})]})})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'16px'},children:/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u6587\\u4EF6\\u683C\\u5F0F\\uFF1A\"}),note.file_format.toUpperCase()]}),/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u521B\\u5EFA\\u65F6\\u95F4\\uFF1A\"}),formatDate(note.created_at)]}),/*#__PURE__*/_jsxs(\"span\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u66F4\\u65B0\\u65F6\\u95F4\\uFF1A\"}),formatDate(note.updated_at)]})]})}),/*#__PURE__*/_jsx(Divider,{}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'16px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u7B14\\u8BB0\\u5185\\u5BB9\\uFF1A\"}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'8px',padding:'12px',backgroundColor:'#f5f5f5',borderRadius:'6px',whiteSpace:'pre-wrap',fontFamily:'monospace',maxHeight:'400px',overflow:'auto'},children:note.content})]})]})]}),note.entities_extracted&&/*#__PURE__*/_jsx(Card,{title:/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:'8px'},children:[/*#__PURE__*/_jsx(NodeIndexOutlined,{}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u63D0\\u53D6\\u7684\\u5B9E\\u4F53\\u4FE1\\u606F\"}),entityData&&/*#__PURE__*/_jsxs(Tag,{color:\"green\",children:[entityData.entities.length,\" \\u4E2A\\u5B9E\\u4F53\\uFF0C\",entityData.relations.length,\" \\u4E2A\\u5173\\u7CFB\"]})]}),/*#__PURE__*/_jsxs(Space,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",size:\"small\",loading:extracting,onClick:handleReExtractEntities,children:\"\\u91CD\\u65B0\\u62BD\\u53D6\"}),/*#__PURE__*/_jsx(Button,{size:\"small\",icon:/*#__PURE__*/_jsx(NodeIndexOutlined,{}),onClick:()=>{if(onEntityVisualize){onEntityVisualize(note);}else{message.info('图谱可视化功能暂不可用');}},children:\"\\u56FE\\u8C31\\u53EF\\u89C6\\u5316\"})]})]}),children:/*#__PURE__*/_jsx(Spin,{spinning:loading,children:entityData?/*#__PURE__*/_jsxs(\"div\",{children:[entityData.entities.length>0?/*#__PURE__*/_jsx(EntityDetailPanel,{entities:entityData.entities,relations:entityData.relations,entityDetails:[]// 这里可以传入更详细的实体信息\n,noteId:note.id}):/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',color:'#999',padding:'20px'},children:\"\\u672A\\u63D0\\u53D6\\u5230\\u5B9E\\u4F53\\u4FE1\\u606F\"}),entityData.metadata&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'16px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u63D0\\u53D6\\u4FE1\\u606F\\uFF1A\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'8px',padding:'8px',backgroundColor:'#f0f0f0',borderRadius:'4px',fontSize:'12px',color:'#666'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u63D0\\u53D6\\u65B9\\u6CD5: \",entityData.metadata.method||'未知']}),entityData.metadata.title&&/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u8BC6\\u522B\\u6807\\u9898: \",entityData.metadata.title]}),entityData.metadata.solution_approach&&/*#__PURE__*/_jsxs(\"div\",{children:[\"\\u89E3\\u9898\\u601D\\u8DEF: \",entityData.metadata.solution_approach]})]})]})]}):/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',color:'#999',padding:'20px'},children:note.entities_extracted?'加载实体信息中...':'未进行实体提取'})})}),!note.entities_extracted&&/*#__PURE__*/_jsx(Card,{title:\"\\u5B9E\\u4F53\\u63D0\\u53D6\",children:/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',color:'#999',padding:'20px'},children:\"\\u8BE5\\u7B14\\u8BB0\\u672A\\u8FDB\\u884C\\u5B9E\\u4F53\\u63D0\\u53D6\"})})]});};export default NoteDetail;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}